{"version":3,"file":"dist/ohif-extension-cornerstone-dicom-sr.umd.js","mappings":"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","sources":["webpack://ohif-extension-cornerstone-dicom-sr/webpack/universalModuleDefinition","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/chunk loaded","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/jsonp chunk loading","webpack://ohif-extension-cornerstone-dicom-sr/./tools/modules/dicomSRModule.js","webpack://ohif-extension-cornerstone-dicom-sr/./utils/hydrateStructuredReport.js","webpack://ohif-extension-cornerstone-dicom-sr/./utils/getLabelFromDCMJSImportedToolData.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/html-parse-stringify/dist/html-parse-stringify.module.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/utils.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/typeof.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/defineProperty.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/unescape.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/defaults.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/TransWithoutContext.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/i18nInstance.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/createClass.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/context.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/slicedToArray.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/useTranslation.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react-i18next/dist/es/index.js","webpack://ohif-extension-cornerstone-dicom-sr/./viewports/OHIFCornerstoneSRViewport.tsx","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/object-assign/index.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/prop-types/factoryWithThrowingShims.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/prop-types/index.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/prop-types/lib/ReactPropTypesSecret.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react/cjs/react.production.min.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/react/index.js","webpack://ohif-extension-cornerstone-dicom-sr/../../../node_modules/void-elements/index.js","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"@cornerstonejs/adapters\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"@cornerstonejs/core\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"@cornerstonejs/tools\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"@ohif/core\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"@ohif/ui\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"dcmjs\"","webpack://ohif-extension-cornerstone-dicom-sr/external umd \"gl-matrix\"","webpack://ohif-extension-cornerstone-dicom-sr/webpack/bootstrap","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/chunk prefetch function","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/compat get default export","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/define property getters","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/hasOwnProperty shorthand","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/make namespace object","webpack://ohif-extension-cornerstone-dicom-sr/webpack/runtime/startup prefetch","webpack://ohif-extension-cornerstone-dicom-sr/./id.js","webpack://ohif-extension-cornerstone-dicom-sr/./constants/scoordTypes.js","webpack://ohif-extension-cornerstone-dicom-sr/./tools/DICOMSRDisplayTool.ts","webpack://ohif-extension-cornerstone-dicom-sr/./tools/toolNames.ts","webpack://ohif-extension-cornerstone-dicom-sr/./utils/addMeasurement.ts","webpack://ohif-extension-cornerstone-dicom-sr/./utils/isRehydratable.js","webpack://ohif-extension-cornerstone-dicom-sr/./getSopClassHandlerModule.ts","webpack://ohif-extension-cornerstone-dicom-sr/./getHangingProtocolModule.ts","webpack://ohif-extension-cornerstone-dicom-sr/./utils/getFilteredCornerstoneToolState.ts","webpack://ohif-extension-cornerstone-dicom-sr/./commandsModule.js","webpack://ohif-extension-cornerstone-dicom-sr/./utils/addToolInstance.ts","webpack://ohif-extension-cornerstone-dicom-sr/./utils/createReferencedImageDisplaySet.ts","webpack://ohif-extension-cornerstone-dicom-sr/./index.tsx","webpack://ohif-extension-cornerstone-dicom-sr/./onModeEnter.js","webpack://ohif-extension-cornerstone-dicom-sr/./init.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@ohif/core\"), require(\"gl-matrix\"), require(\"@cornerstonejs/tools\"), require(\"@cornerstonejs/core\"), require(\"@cornerstonejs/adapters\"), require(\"dcmjs\"), require(\"@ohif/ui\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@ohif/core\", \"gl-matrix\", \"@cornerstonejs/tools\", \"@cornerstonejs/core\", \"@cornerstonejs/adapters\", \"dcmjs\", \"@ohif/ui\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ohif-extension-cornerstone-dicom-sr\"] = factory(require(\"@ohif/core\"), require(\"gl-matrix\"), require(\"@cornerstonejs/tools\"), require(\"@cornerstonejs/core\"), require(\"@cornerstonejs/adapters\"), require(\"dcmjs\"), require(\"@ohif/ui\"));\n\telse\n\t\troot[\"ohif-extension-cornerstone-dicom-sr\"] = factory(root[\"@ohif/core\"], root[\"gl-matrix\"], root[\"@cornerstonejs/tools\"], root[\"@cornerstonejs/core\"], root[\"@cornerstonejs/adapters\"], root[\"dcmjs\"], root[\"@ohif/ui\"]);\n})(globalThis, (__WEBPACK_EXTERNAL_MODULE__762__, __WEBPACK_EXTERNAL_MODULE__845__, __WEBPACK_EXTERNAL_MODULE__867__, __WEBPACK_EXTERNAL_MODULE__464__, __WEBPACK_EXTERNAL_MODULE__32__, __WEBPACK_EXTERNAL_MODULE__836__, __WEBPACK_EXTERNAL_MODULE__369__) => {\nreturn ","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t143: 0\n};\n\n// no chunk on demand loading\n\n__webpack_require__.F.j = (chunkId) => {\n\tif((!__webpack_require__.o(installedChunks, chunkId) || installedChunks[chunkId] === undefined) && true) {\n\t\tinstalledChunks[chunkId] = null;\n\t\tvar link = document.createElement('link');\n\n\t\tif (__webpack_require__.nc) {\n\t\t\tlink.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tlink.rel = \"prefetch\";\n\t\tlink.as = \"script\";\n\t\tlink.href = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\tdocument.head.appendChild(link);\n\t}\n};\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// no jsonp function","import { getEnabledElement } from '@cornerstonejs/core';\n\nconst state = {\n  TrackingUniqueIdentifier: null,\n  trackingIdentifiersByViewportId: {},\n};\n\n/**\n * This file is being used to store the per-viewport state of the SR tools,\n * Since, all the toolStates are added to the cornerstoneTools, when displaying the SRTools,\n * if there are two viewports rendering the same imageId, we don't want to show\n * the same SR annotation twice on irrelevant viewport, hence, we are storing the state\n * of the SR tools in state here, so that we can filter them later.\n */\n\nfunction setTrackingUniqueIdentifiersForElement(\n  element,\n  trackingUniqueIdentifiers,\n  activeIndex = 0\n) {\n  const enabledElement = getEnabledElement(element);\n  const { viewport } = enabledElement;\n\n  state.trackingIdentifiersByViewportId[viewport.id] = {\n    trackingUniqueIdentifiers,\n    activeIndex,\n  };\n}\n\nfunction setActiveTrackingUniqueIdentifierForElement(\n  element,\n  TrackingUniqueIdentifier\n) {\n  const enabledElement = getEnabledElement(element);\n  const { viewport } = enabledElement;\n\n  const trackingIdentifiersForElement =\n    state.trackingIdentifiersByViewportId[viewport.id];\n\n  if (trackingIdentifiersForElement) {\n    const activeIndex = trackingIdentifiersForElement.trackingUniqueIdentifiers.findIndex(\n      tuid => tuid === TrackingUniqueIdentifier\n    );\n\n    trackingIdentifiersForElement.activeIndex = activeIndex;\n  }\n}\n\nfunction getTrackingUniqueIdentifiersForElement(element) {\n  const enabledElement = getEnabledElement(element);\n  const { viewport } = enabledElement;\n\n  if (state.trackingIdentifiersByViewportId[viewport.id]) {\n    return state.trackingIdentifiersByViewportId[viewport.id];\n  }\n\n  return { trackingUniqueIdentifiers: [] };\n}\n\nexport {\n  setTrackingUniqueIdentifiersForElement,\n  setActiveTrackingUniqueIdentifierForElement,\n  getTrackingUniqueIdentifiersForElement,\n};\n","import { utilities, metaData } from '@cornerstonejs/core';\nimport OHIF, { DicomMetadataStore } from '@ohif/core';\nimport getLabelFromDCMJSImportedToolData from './getLabelFromDCMJSImportedToolData';\nimport { adaptersSR } from '@cornerstonejs/adapters';\n\nconst { guid } = OHIF.utils;\nconst { MeasurementReport, CORNERSTONE_3D_TAG } = adaptersSR.Cornerstone3D;\n\nconst CORNERSTONE_3D_TOOLS_SOURCE_NAME = 'Cornerstone3DTools';\nconst CORNERSTONE_3D_TOOLS_SOURCE_VERSION = '0.1';\n\nconst supportedLegacyCornerstoneTags = ['cornerstoneTools@^4.0.0'];\n\nconst convertCode = (codingValues, code) => {\n  if (!code || code.CodingSchemeDesignator === 'CORNERSTONEJS') return;\n  const ref = `${code.CodingSchemeDesignator}:${code.CodeValue}`;\n  const ret = { ...codingValues[ref], ref, ...code, text: code.CodeMeaning };\n  return ret;\n};\n\nconst convertSites = (codingValues, sites) => {\n  if (!sites || !sites.length) return;\n  const ret = [];\n  // Do as a loop to convert away from Proxy instances\n  for (let i = 0; i < sites.length; i++) {\n    // Deal with irregular conversion from dcmjs\n    const site = convertCode(codingValues, sites[i][0] || sites[i]);\n    if (site) ret.push(site);\n  }\n  return (ret.length && ret) || undefined;\n};\n\n/**\n * Hydrates a structured report, for default viewports.\n *\n */\nexport default function hydrateStructuredReport(\n  { servicesManager, extensionManager },\n  displaySetInstanceUID\n) {\n  const dataSource = extensionManager.getActiveDataSource()[0];\n  const {\n    measurementService,\n    displaySetService,\n    customizationService,\n  } = servicesManager.services;\n\n  const codingValues = customizationService.getCustomization(\n    'codingValues',\n    {}\n  );\n  const displaySet = displaySetService.getDisplaySetByUID(\n    displaySetInstanceUID\n  );\n\n  // TODO -> We should define a strict versioning somewhere.\n  const mappings = measurementService.getSourceMappings(\n    CORNERSTONE_3D_TOOLS_SOURCE_NAME,\n    CORNERSTONE_3D_TOOLS_SOURCE_VERSION\n  );\n\n  if (!mappings || !mappings.length) {\n    throw new Error(\n      `Attempting to hydrate measurements service when no mappings present. This shouldn't be reached.`\n    );\n  }\n\n  const instance = DicomMetadataStore.getInstance(\n    displaySet.StudyInstanceUID,\n    displaySet.SeriesInstanceUID,\n    displaySet.SOPInstanceUID\n  );\n\n  const sopInstanceUIDToImageId = {};\n  const imageIdsForToolState = {};\n\n  displaySet.measurements.forEach(measurement => {\n    const { ReferencedSOPInstanceUID, imageId, frameNumber } = measurement;\n\n    if (!sopInstanceUIDToImageId[ReferencedSOPInstanceUID]) {\n      sopInstanceUIDToImageId[ReferencedSOPInstanceUID] = imageId;\n      imageIdsForToolState[ReferencedSOPInstanceUID] = [];\n    }\n    if (!imageIdsForToolState[ReferencedSOPInstanceUID][frameNumber]) {\n      imageIdsForToolState[ReferencedSOPInstanceUID][frameNumber] = imageId;\n    }\n  });\n\n  const datasetToUse = _mapLegacyDataSet(instance);\n\n  // Use dcmjs to generate toolState.\n  const storedMeasurementByAnnotationType = MeasurementReport.generateToolState(\n    datasetToUse,\n    // NOTE: we need to pass in the imageIds to dcmjs since the we use them\n    // for the imageToWorld transformation. The following assumes that the order\n    // that measurements were added to the display set are the same order as\n    // the measurementGroups in the instance.\n    sopInstanceUIDToImageId,\n    utilities.imageToWorldCoords,\n    metaData\n  );\n\n  // Filter what is found by DICOM SR to measurements we support.\n  const mappingDefinitions = mappings.map(m => m.annotationType);\n  const hydratableMeasurementsInSR = {};\n\n  Object.keys(storedMeasurementByAnnotationType).forEach(key => {\n    if (mappingDefinitions.includes(key)) {\n      hydratableMeasurementsInSR[key] = storedMeasurementByAnnotationType[key];\n    }\n  });\n\n  // Set the series touched as tracked.\n  const imageIds = [];\n\n  // TODO: notification if no hydratable?\n  Object.keys(hydratableMeasurementsInSR).forEach(annotationType => {\n    const toolDataForAnnotationType =\n      hydratableMeasurementsInSR[annotationType];\n\n    toolDataForAnnotationType.forEach(toolData => {\n      // Add the measurement to toolState\n      // dcmjs and Cornerstone3D has structural defect in supporting multi-frame\n      // files, and looking up the imageId from sopInstanceUIDToImageId results\n      // in the wrong value.\n      const frameNumber =\n        (toolData.annotation.data && toolData.annotation.data.frameNumber) || 1;\n      const imageId =\n        imageIdsForToolState[toolData.sopInstanceUid][frameNumber] ||\n        sopInstanceUIDToImageId[toolData.sopInstanceUid];\n\n      if (!imageIds.includes(imageId)) {\n        imageIds.push(imageId);\n      }\n    });\n  });\n\n  let targetStudyInstanceUID;\n  const SeriesInstanceUIDs = [];\n\n  for (let i = 0; i < imageIds.length; i++) {\n    const imageId = imageIds[i];\n    const { SeriesInstanceUID, StudyInstanceUID } = metaData.get(\n      'instance',\n      imageId\n    );\n\n    if (!SeriesInstanceUIDs.includes(SeriesInstanceUID)) {\n      SeriesInstanceUIDs.push(SeriesInstanceUID);\n    }\n\n    if (!targetStudyInstanceUID) {\n      targetStudyInstanceUID = StudyInstanceUID;\n    } else if (targetStudyInstanceUID !== StudyInstanceUID) {\n      console.warn(\n        'NO SUPPORT FOR SRs THAT HAVE MEASUREMENTS FROM MULTIPLE STUDIES.'\n      );\n    }\n  }\n\n  Object.keys(hydratableMeasurementsInSR).forEach(annotationType => {\n    const toolDataForAnnotationType =\n      hydratableMeasurementsInSR[annotationType];\n\n    toolDataForAnnotationType.forEach(toolData => {\n      // Add the measurement to toolState\n      // dcmjs and Cornerstone3D has structural defect in supporting multi-frame\n      // files, and looking up the imageId from sopInstanceUIDToImageId results\n      // in the wrong value.\n      const frameNumber =\n        (toolData.annotation.data && toolData.annotation.data.frameNumber) || 1;\n      const imageId =\n        imageIdsForToolState[toolData.sopInstanceUid][frameNumber] ||\n        sopInstanceUIDToImageId[toolData.sopInstanceUid];\n\n      toolData.uid = guid();\n\n      const instance = metaData.get('instance', imageId);\n      const {\n        FrameOfReferenceUID,\n        // SOPInstanceUID,\n        // SeriesInstanceUID,\n        // StudyInstanceUID,\n      } = instance;\n\n      const annotation = {\n        annotationUID: toolData.annotation.annotationUID,\n        data: toolData.annotation.data,\n        metadata: {\n          toolName: annotationType,\n          referencedImageId: imageId,\n          FrameOfReferenceUID,\n        },\n      };\n\n      const source = measurementService.getSource(\n        CORNERSTONE_3D_TOOLS_SOURCE_NAME,\n        CORNERSTONE_3D_TOOLS_SOURCE_VERSION\n      );\n      annotation.data.label = getLabelFromDCMJSImportedToolData(toolData);\n      annotation.data.finding = convertCode(\n        codingValues,\n        toolData.finding?.[0]\n      );\n      annotation.data.findingSites = convertSites(\n        codingValues,\n        toolData.findingSites\n      );\n      annotation.data.site = annotation.data.findingSites?.[0];\n\n      const matchingMapping = mappings.find(\n        m => m.annotationType === annotationType\n      );\n\n      measurementService.addRawMeasurement(\n        source,\n        annotationType,\n        { annotation },\n        matchingMapping.toMeasurementSchema,\n        dataSource\n      );\n\n      if (!imageIds.includes(imageId)) {\n        imageIds.push(imageId);\n      }\n    });\n  });\n\n  displaySet.isHydrated = true;\n\n  return {\n    StudyInstanceUID: targetStudyInstanceUID,\n    SeriesInstanceUIDs,\n  };\n}\n\nfunction _mapLegacyDataSet(dataset) {\n  const REPORT = 'Imaging Measurements';\n  const GROUP = 'Measurement Group';\n  const TRACKING_IDENTIFIER = 'Tracking Identifier';\n\n  // Identify the Imaging Measurements\n  const imagingMeasurementContent = toArray(dataset.ContentSequence).find(\n    codeMeaningEquals(REPORT)\n  );\n\n  // Retrieve the Measurements themselves\n  const measurementGroups = toArray(\n    imagingMeasurementContent.ContentSequence\n  ).filter(codeMeaningEquals(GROUP));\n\n  // For each of the supported measurement types, compute the measurement data\n  const measurementData = {};\n\n  const cornerstoneToolClasses =\n    MeasurementReport.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE;\n\n  const registeredToolClasses = [];\n\n  Object.keys(cornerstoneToolClasses).forEach(key => {\n    registeredToolClasses.push(cornerstoneToolClasses[key]);\n    measurementData[key] = [];\n  });\n\n  measurementGroups.forEach((measurementGroup, index) => {\n    const measurementGroupContentSequence = toArray(\n      measurementGroup.ContentSequence\n    );\n\n    const TrackingIdentifierGroup = measurementGroupContentSequence.find(\n      contentItem =>\n        contentItem.ConceptNameCodeSequence.CodeMeaning === TRACKING_IDENTIFIER\n    );\n\n    const TrackingIdentifier = TrackingIdentifierGroup.TextValue;\n\n    let [cornerstoneTag, toolName] = TrackingIdentifier.split(':');\n    if (supportedLegacyCornerstoneTags.includes(cornerstoneTag)) {\n      cornerstoneTag = CORNERSTONE_3D_TAG;\n    }\n\n    const mappedTrackingIdentifier = `${cornerstoneTag}:${toolName}`;\n\n    TrackingIdentifierGroup.TextValue = mappedTrackingIdentifier;\n  });\n\n  return dataset;\n}\n\nconst toArray = function (x) {\n  return Array.isArray(x) ? x : [x];\n};\n\nconst codeMeaningEquals = codeMeaningName => {\n  return contentItem => {\n    return contentItem.ConceptNameCodeSequence.CodeMeaning === codeMeaningName;\n  };\n};\n","/**\n * Extracts the label from the toolData imported from dcmjs. We need to do this\n * as dcmjs does not depeend on OHIF/the measurementService, it just produces data for cornestoneTools.\n * This optional data is available for the consumer to process if they wish to.\n * @param {object} toolData The tooldata relating to the\n *\n * @returns {string} The extracted label.\n */\nexport default function getLabelFromDCMJSImportedToolData(toolData) {\n  const { findingSites = [], finding } = toolData;\n\n  let freeTextLabel = findingSites.find(\n    fs => fs.CodeValue === 'CORNERSTONEFREETEXT'\n  );\n\n  if (freeTextLabel) {\n    return freeTextLabel.CodeMeaning;\n  }\n\n  if (finding && finding.CodeValue === 'CORNERSTONEFREETEXT') {\n    return finding.CodeMeaning;\n  }\n}\n","import e from\"void-elements\";var t=/\\s([^'\"/\\s><]+?)[\\s/>]|([^\\s=]+)=\\s?(\".*?\"|'.*?')/g;function n(n){var r={type:\"tag\",name:\"\",voidElement:!1,attrs:{},children:[]},i=n.match(/<\\/?([^\\s]+?)[/\\s>]/);if(i&&(r.name=i[1],(e[i[1]]||\"/\"===n.charAt(n.length-2))&&(r.voidElement=!0),r.name.startsWith(\"!--\"))){var s=n.indexOf(\"--\\x3e\");return{type:\"comment\",comment:-1!==s?n.slice(4,s):\"\"}}for(var a=new RegExp(t),c=null;null!==(c=a.exec(n));)if(c[0].trim())if(c[1]){var o=c[1].trim(),l=[o,\"\"];o.indexOf(\"=\")>-1&&(l=o.split(\"=\")),r.attrs[l[0]]=l[1],a.lastIndex--}else c[2]&&(r.attrs[c[2]]=c[3].trim().substring(1,c[3].length-1));return r}var r=/<[a-zA-Z0-9\\-\\!\\/](?:\"[^\"]*\"|'[^']*'|[^'\">])*>/g,i=/^\\s*$/,s=Object.create(null);function a(e,t){switch(t.type){case\"text\":return e+t.content;case\"tag\":return e+=\"<\"+t.name+(t.attrs?function(e){var t=[];for(var n in e)t.push(n+'=\"'+e[n]+'\"');return t.length?\" \"+t.join(\" \"):\"\"}(t.attrs):\"\")+(t.voidElement?\"/>\":\">\"),t.voidElement?e:e+t.children.reduce(a,\"\")+\"</\"+t.name+\">\";case\"comment\":return e+\"\\x3c!--\"+t.comment+\"--\\x3e\"}}var c={parse:function(e,t){t||(t={}),t.components||(t.components=s);var a,c=[],o=[],l=-1,m=!1;if(0!==e.indexOf(\"<\")){var u=e.indexOf(\"<\");c.push({type:\"text\",content:-1===u?e:e.substring(0,u)})}return e.replace(r,function(r,s){if(m){if(r!==\"</\"+a.name+\">\")return;m=!1}var u,f=\"/\"!==r.charAt(1),h=r.startsWith(\"\\x3c!--\"),p=s+r.length,d=e.charAt(p);if(h){var v=n(r);return l<0?(c.push(v),c):((u=o[l]).children.push(v),c)}if(f&&(l++,\"tag\"===(a=n(r)).type&&t.components[a.name]&&(a.type=\"component\",m=!0),a.voidElement||m||!d||\"<\"===d||a.children.push({type:\"text\",content:e.slice(p,e.indexOf(\"<\",p))}),0===l&&c.push(a),(u=o[l-1])&&u.children.push(a),o[l]=a),(!f||a.voidElement)&&(l>-1&&(a.voidElement||a.name===r.slice(2,-1))&&(l--,a=-1===l?c:o[l]),!m&&\"<\"!==d&&d)){u=-1===l?c:o[l].children;var x=e.indexOf(\"<\",p),g=e.slice(p,-1===x?void 0:x);i.test(g)&&(g=\" \"),(x>-1&&l+u.length>=0||\" \"!==g)&&u.push({type:\"text\",content:g})}}),c},stringify:function(e){return e.reduce(function(e,t){return e+a(\"\",t)},\"\")}};export default c;\n//# sourceMappingURL=html-parse-stringify.module.js.map\n","export function warn() {\n  if (console && console.warn) {\n    var _console;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    if (typeof args[0] === 'string') args[0] = \"react-i18next:: \".concat(args[0]);\n\n    (_console = console).warn.apply(_console, args);\n  }\n}\nvar alreadyWarned = {};\nexport function warnOnce() {\n  for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n    args[_key2] = arguments[_key2];\n  }\n\n  if (typeof args[0] === 'string' && alreadyWarned[args[0]]) return;\n  if (typeof args[0] === 'string') alreadyWarned[args[0]] = new Date();\n  warn.apply(void 0, args);\n}\n\nvar loadedClb = function loadedClb(i18n, cb) {\n  return function () {\n    if (i18n.isInitialized) {\n      cb();\n    } else {\n      var initialized = function initialized() {\n        setTimeout(function () {\n          i18n.off('initialized', initialized);\n        }, 0);\n        cb();\n      };\n\n      i18n.on('initialized', initialized);\n    }\n  };\n};\n\nexport function loadNamespaces(i18n, ns, cb) {\n  i18n.loadNamespaces(ns, loadedClb(i18n, cb));\n}\nexport function loadLanguages(i18n, lng, ns, cb) {\n  if (typeof ns === 'string') ns = [ns];\n  ns.forEach(function (n) {\n    if (i18n.options.ns.indexOf(n) < 0) i18n.options.ns.push(n);\n  });\n  i18n.loadLanguages(lng, loadedClb(i18n, cb));\n}\n\nfunction oldI18nextHasLoadedNamespace(ns, i18n) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var lng = i18n.languages[0];\n  var fallbackLng = i18n.options ? i18n.options.fallbackLng : false;\n  var lastLng = i18n.languages[i18n.languages.length - 1];\n  if (lng.toLowerCase() === 'cimode') return true;\n\n  var loadNotPending = function loadNotPending(l, n) {\n    var loadState = i18n.services.backendConnector.state[\"\".concat(l, \"|\").concat(n)];\n    return loadState === -1 || loadState === 2;\n  };\n\n  if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18n.services.backendConnector.backend && i18n.isLanguageChangingTo && !loadNotPending(i18n.isLanguageChangingTo, ns)) return false;\n  if (i18n.hasResourceBundle(lng, ns)) return true;\n  if (!i18n.services.backendConnector.backend || i18n.options.resources && !i18n.options.partialBundledLanguages) return true;\n  if (loadNotPending(lng, ns) && (!fallbackLng || loadNotPending(lastLng, ns))) return true;\n  return false;\n}\n\nexport function hasLoadedNamespace(ns, i18n) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  if (!i18n.languages || !i18n.languages.length) {\n    warnOnce('i18n.languages were undefined or empty', i18n.languages);\n    return true;\n  }\n\n  var isNewerI18next = i18n.options.ignoreJSONStructure !== undefined;\n\n  if (!isNewerI18next) {\n    return oldI18nextHasLoadedNamespace(ns, i18n, options);\n  }\n\n  return i18n.hasLoadedNamespace(ns, {\n    lng: options.lng,\n    precheck: function precheck(i18nInstance, loadNotPending) {\n      if (options.bindI18n && options.bindI18n.indexOf('languageChanging') > -1 && i18nInstance.services.backendConnector.backend && i18nInstance.isLanguageChangingTo && !loadNotPending(i18nInstance.isLanguageChangingTo, ns)) return false;\n    }\n  });\n}\nexport function getDisplayName(Component) {\n  return Component.displayName || Component.name || (typeof Component === 'string' && Component.length > 0 ? Component : 'Unknown');\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","var matchHtmlEntity = /&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g;\nvar htmlEntities = {\n  '&amp;': '&',\n  '&#38;': '&',\n  '&lt;': '<',\n  '&#60;': '<',\n  '&gt;': '>',\n  '&#62;': '>',\n  '&apos;': \"'\",\n  '&#39;': \"'\",\n  '&quot;': '\"',\n  '&#34;': '\"',\n  '&nbsp;': ' ',\n  '&#160;': ' ',\n  '&copy;': '',\n  '&#169;': '',\n  '&reg;': '',\n  '&#174;': '',\n  '&hellip;': '',\n  '&#8230;': '',\n  '&#x2F;': '/',\n  '&#47;': '/'\n};\n\nvar unescapeHtmlEntity = function unescapeHtmlEntity(m) {\n  return htmlEntities[m];\n};\n\nexport var unescape = function unescape(text) {\n  return text.replace(matchHtmlEntity, unescapeHtmlEntity);\n};","import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { unescape } from './unescape.js';\nvar defaultOptions = {\n  bindI18n: 'languageChanged',\n  bindI18nStore: '',\n  transEmptyNodeValue: '',\n  transSupportBasicHtmlNodes: true,\n  transWrapTextNodes: '',\n  transKeepBasicHtmlNodesFor: ['br', 'strong', 'i', 'p'],\n  useSuspense: true,\n  unescape: unescape\n};\nexport function setDefaults() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  defaultOptions = _objectSpread(_objectSpread({}, defaultOptions), options);\n}\nexport function getDefaults() {\n  return defaultOptions;\n}","import _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nvar _excluded = [\"format\"],\n    _excluded2 = [\"children\", \"count\", \"parent\", \"i18nKey\", \"context\", \"tOptions\", \"values\", \"defaults\", \"components\", \"ns\", \"i18n\", \"t\", \"shouldUnescape\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { isValidElement, cloneElement, createElement } from 'react';\nimport HTML from 'html-parse-stringify';\nimport { warn, warnOnce } from './utils.js';\nimport { getDefaults } from './defaults.js';\nimport { getI18n } from './i18nInstance.js';\n\nfunction hasChildren(node, checkLength) {\n  if (!node) return false;\n  var base = node.props ? node.props.children : node.children;\n  if (checkLength) return base.length > 0;\n  return !!base;\n}\n\nfunction getChildren(node) {\n  if (!node) return [];\n  return node.props ? node.props.children : node.children;\n}\n\nfunction hasValidReactChildren(children) {\n  if (Object.prototype.toString.call(children) !== '[object Array]') return false;\n  return children.every(function (child) {\n    return isValidElement(child);\n  });\n}\n\nfunction getAsArray(data) {\n  return Array.isArray(data) ? data : [data];\n}\n\nfunction mergeProps(source, target) {\n  var newTarget = _objectSpread({}, target);\n\n  newTarget.props = Object.assign(source.props, target.props);\n  return newTarget;\n}\n\nexport function nodesToString(children, i18nOptions) {\n  if (!children) return '';\n  var stringNode = '';\n  var childrenArray = getAsArray(children);\n  var keepArray = i18nOptions.transSupportBasicHtmlNodes && i18nOptions.transKeepBasicHtmlNodesFor ? i18nOptions.transKeepBasicHtmlNodesFor : [];\n  childrenArray.forEach(function (child, childIndex) {\n    if (typeof child === 'string') {\n      stringNode += \"\".concat(child);\n    } else if (isValidElement(child)) {\n      var childPropsCount = Object.keys(child.props).length;\n      var shouldKeepChild = keepArray.indexOf(child.type) > -1;\n      var childChildren = child.props.children;\n\n      if (!childChildren && shouldKeepChild && childPropsCount === 0) {\n        stringNode += \"<\".concat(child.type, \"/>\");\n      } else if (!childChildren && (!shouldKeepChild || childPropsCount !== 0)) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (child.props.i18nIsDynamicList) {\n        stringNode += \"<\".concat(childIndex, \"></\").concat(childIndex, \">\");\n      } else if (shouldKeepChild && childPropsCount === 1 && typeof childChildren === 'string') {\n        stringNode += \"<\".concat(child.type, \">\").concat(childChildren, \"</\").concat(child.type, \">\");\n      } else {\n        var content = nodesToString(childChildren, i18nOptions);\n        stringNode += \"<\".concat(childIndex, \">\").concat(content, \"</\").concat(childIndex, \">\");\n      }\n    } else if (child === null) {\n      warn(\"Trans: the passed in value is invalid - seems you passed in a null child.\");\n    } else if (_typeof(child) === 'object') {\n      var format = child.format,\n          clone = _objectWithoutProperties(child, _excluded);\n\n      var keys = Object.keys(clone);\n\n      if (keys.length === 1) {\n        var value = format ? \"\".concat(keys[0], \", \").concat(format) : keys[0];\n        stringNode += \"{{\".concat(value, \"}}\");\n      } else {\n        warn(\"react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.\", child);\n      }\n    } else {\n      warn(\"Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.\", child);\n    }\n  });\n  return stringNode;\n}\n\nfunction renderNodes(children, targetString, i18n, i18nOptions, combinedTOpts, shouldUnescape) {\n  if (targetString === '') return [];\n  var keepArray = i18nOptions.transKeepBasicHtmlNodesFor || [];\n  var emptyChildrenButNeedsHandling = targetString && new RegExp(keepArray.join('|')).test(targetString);\n  if (!children && !emptyChildrenButNeedsHandling) return [targetString];\n  var data = {};\n\n  function getData(childs) {\n    var childrenArray = getAsArray(childs);\n    childrenArray.forEach(function (child) {\n      if (typeof child === 'string') return;\n      if (hasChildren(child)) getData(getChildren(child));else if (_typeof(child) === 'object' && !isValidElement(child)) Object.assign(data, child);\n    });\n  }\n\n  getData(children);\n  var ast = HTML.parse(\"<0>\".concat(targetString, \"</0>\"));\n\n  var opts = _objectSpread(_objectSpread({}, data), combinedTOpts);\n\n  function renderInner(child, node, rootReactNode) {\n    var childs = getChildren(child);\n    var mappedChildren = mapAST(childs, node.children, rootReactNode);\n    return hasValidReactChildren(childs) && mappedChildren.length === 0 ? childs : mappedChildren;\n  }\n\n  function pushTranslatedJSX(child, inner, mem, i, isVoid) {\n    if (child.dummy) child.children = inner;\n    mem.push(cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n      key: i\n    }), isVoid ? undefined : inner));\n  }\n\n  function mapAST(reactNode, astNode, rootReactNode) {\n    var reactNodes = getAsArray(reactNode);\n    var astNodes = getAsArray(astNode);\n    return astNodes.reduce(function (mem, node, i) {\n      var translationContent = node.children && node.children[0] && node.children[0].content && i18n.services.interpolator.interpolate(node.children[0].content, opts, i18n.language);\n\n      if (node.type === 'tag') {\n        var tmp = reactNodes[parseInt(node.name, 10)];\n        if (!tmp && rootReactNode.length === 1 && rootReactNode[0][node.name]) tmp = rootReactNode[0][node.name];\n        if (!tmp) tmp = {};\n        var child = Object.keys(node.attrs).length !== 0 ? mergeProps({\n          props: node.attrs\n        }, tmp) : tmp;\n        var isElement = isValidElement(child);\n        var isValidTranslationWithChildren = isElement && hasChildren(node, true) && !node.voidElement;\n        var isEmptyTransWithHTML = emptyChildrenButNeedsHandling && _typeof(child) === 'object' && child.dummy && !isElement;\n        var isKnownComponent = _typeof(children) === 'object' && children !== null && Object.hasOwnProperty.call(children, node.name);\n\n        if (typeof child === 'string') {\n          var value = i18n.services.interpolator.interpolate(child, opts, i18n.language);\n          mem.push(value);\n        } else if (hasChildren(child) || isValidTranslationWithChildren) {\n            var inner = renderInner(child, node, rootReactNode);\n            pushTranslatedJSX(child, inner, mem, i);\n          } else if (isEmptyTransWithHTML) {\n          var _inner = mapAST(reactNodes, node.children, rootReactNode);\n\n          mem.push(cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          }), _inner));\n        } else if (Number.isNaN(parseFloat(node.name))) {\n          if (isKnownComponent) {\n            var _inner2 = renderInner(child, node, rootReactNode);\n\n            pushTranslatedJSX(child, _inner2, mem, i, node.voidElement);\n          } else if (i18nOptions.transSupportBasicHtmlNodes && keepArray.indexOf(node.name) > -1) {\n            if (node.voidElement) {\n              mem.push(createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }));\n            } else {\n              var _inner3 = mapAST(reactNodes, node.children, rootReactNode);\n\n              mem.push(createElement(node.name, {\n                key: \"\".concat(node.name, \"-\").concat(i)\n              }, _inner3));\n            }\n          } else if (node.voidElement) {\n            mem.push(\"<\".concat(node.name, \" />\"));\n          } else {\n            var _inner4 = mapAST(reactNodes, node.children, rootReactNode);\n\n            mem.push(\"<\".concat(node.name, \">\").concat(_inner4, \"</\").concat(node.name, \">\"));\n          }\n        } else if (_typeof(child) === 'object' && !isElement) {\n          var content = node.children[0] ? translationContent : null;\n          if (content) mem.push(content);\n        } else if (node.children.length === 1 && translationContent) {\n          mem.push(cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          }), translationContent));\n        } else {\n          mem.push(cloneElement(child, _objectSpread(_objectSpread({}, child.props), {}, {\n            key: i\n          })));\n        }\n      } else if (node.type === 'text') {\n        var wrapTextNodes = i18nOptions.transWrapTextNodes;\n\n        var _content = shouldUnescape ? i18nOptions.unescape(i18n.services.interpolator.interpolate(node.content, opts, i18n.language)) : i18n.services.interpolator.interpolate(node.content, opts, i18n.language);\n\n        if (wrapTextNodes) {\n          mem.push(createElement(wrapTextNodes, {\n            key: \"\".concat(node.name, \"-\").concat(i)\n          }, _content));\n        } else {\n          mem.push(_content);\n        }\n      }\n\n      return mem;\n    }, []);\n  }\n\n  var result = mapAST([{\n    dummy: true,\n    children: children || []\n  }], ast, getAsArray(children || []));\n  return getChildren(result[0]);\n}\n\nexport function Trans(_ref) {\n  var children = _ref.children,\n      count = _ref.count,\n      parent = _ref.parent,\n      i18nKey = _ref.i18nKey,\n      context = _ref.context,\n      _ref$tOptions = _ref.tOptions,\n      tOptions = _ref$tOptions === void 0 ? {} : _ref$tOptions,\n      values = _ref.values,\n      defaults = _ref.defaults,\n      components = _ref.components,\n      ns = _ref.ns,\n      i18nFromProps = _ref.i18n,\n      tFromProps = _ref.t,\n      shouldUnescape = _ref.shouldUnescape,\n      additionalProps = _objectWithoutProperties(_ref, _excluded2);\n\n  var i18n = i18nFromProps || getI18n();\n\n  if (!i18n) {\n    warnOnce('You will need to pass in an i18next instance by using i18nextReactModule');\n    return children;\n  }\n\n  var t = tFromProps || i18n.t.bind(i18n) || function (k) {\n    return k;\n  };\n\n  if (context) tOptions.context = context;\n\n  var reactI18nextOptions = _objectSpread(_objectSpread({}, getDefaults()), i18n.options && i18n.options.react);\n\n  var namespaces = ns || t.ns || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  var defaultValue = defaults || nodesToString(children, reactI18nextOptions) || reactI18nextOptions.transEmptyNodeValue || i18nKey;\n  var hashTransKey = reactI18nextOptions.hashTransKey;\n  var key = i18nKey || (hashTransKey ? hashTransKey(defaultValue) : defaultValue);\n  var interpolationOverride = values ? tOptions.interpolation : {\n    interpolation: _objectSpread(_objectSpread({}, tOptions.interpolation), {}, {\n      prefix: '#$?',\n      suffix: '?$#'\n    })\n  };\n\n  var combinedTOpts = _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, tOptions), {}, {\n    count: count\n  }, values), interpolationOverride), {}, {\n    defaultValue: defaultValue,\n    ns: namespaces\n  });\n\n  var translation = key ? t(key, combinedTOpts) : defaultValue;\n  var content = renderNodes(components || children, translation, i18n, reactI18nextOptions, combinedTOpts, shouldUnescape);\n  var useAsParent = parent !== undefined ? parent : reactI18nextOptions.defaultTransParent;\n  return useAsParent ? createElement(useAsParent, additionalProps, content) : content;\n}","var i18nInstance;\nexport function setI18n(instance) {\n  i18nInstance = instance;\n}\nexport function getI18n() {\n  return i18nInstance;\n}","import toPropertyKey from \"./toPropertyKey.js\";\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, toPropertyKey(descriptor.key), descriptor);\n  }\n}\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createContext } from 'react';\nimport { getDefaults, setDefaults } from './defaults.js';\nimport { getI18n, setI18n } from './i18nInstance.js';\nimport { initReactI18next } from './initReactI18next.js';\nexport { getDefaults, setDefaults, getI18n, setI18n, initReactI18next };\nexport var I18nContext = createContext();\nexport var ReportNamespaces = function () {\n  function ReportNamespaces() {\n    _classCallCheck(this, ReportNamespaces);\n\n    this.usedNamespaces = {};\n  }\n\n  _createClass(ReportNamespaces, [{\n    key: \"addUsedNamespaces\",\n    value: function addUsedNamespaces(namespaces) {\n      var _this = this;\n\n      namespaces.forEach(function (ns) {\n        if (!_this.usedNamespaces[ns]) _this.usedNamespaces[ns] = true;\n      });\n    }\n  }, {\n    key: \"getUsedNamespaces\",\n    value: function getUsedNamespaces() {\n      return Object.keys(this.usedNamespaces);\n    }\n  }]);\n\n  return ReportNamespaces;\n}();\nexport function composeInitialProps(ForComponent) {\n  return function (ctx) {\n    return new Promise(function (resolve) {\n      var i18nInitialProps = getInitialProps();\n\n      if (ForComponent.getInitialProps) {\n        ForComponent.getInitialProps(ctx).then(function (componentsInitialProps) {\n          resolve(_objectSpread(_objectSpread({}, componentsInitialProps), i18nInitialProps));\n        });\n      } else {\n        resolve(i18nInitialProps);\n      }\n    });\n  };\n}\nexport function getInitialProps() {\n  var i18n = getI18n();\n  var namespaces = i18n.reportNamespaces ? i18n.reportNamespaces.getUsedNamespaces() : [];\n  var ret = {};\n  var initialI18nStore = {};\n  i18n.languages.forEach(function (l) {\n    initialI18nStore[l] = {};\n    namespaces.forEach(function (ns) {\n      initialI18nStore[l][ns] = i18n.getResourceBundle(l, ns) || {};\n    });\n  });\n  ret.initialI18nStore = initialI18nStore;\n  ret.initialLanguage = i18n.language;\n  return ret;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _typeof from \"@babel/runtime/helpers/typeof\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect, useContext, useRef } from 'react';\nimport { getI18n, getDefaults, ReportNamespaces, I18nContext } from './context.js';\nimport { warnOnce, loadNamespaces, loadLanguages, hasLoadedNamespace } from './utils.js';\n\nvar usePrevious = function usePrevious(value, ignore) {\n  var ref = useRef();\n  useEffect(function () {\n    ref.current = ignore ? ref.current : value;\n  }, [value, ignore]);\n  return ref.current;\n};\n\nexport function useTranslation(ns) {\n  var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var i18nFromProps = props.i18n;\n\n  var _ref = useContext(I18nContext) || {},\n      i18nFromContext = _ref.i18n,\n      defaultNSFromContext = _ref.defaultNS;\n\n  var i18n = i18nFromProps || i18nFromContext || getI18n();\n  if (i18n && !i18n.reportNamespaces) i18n.reportNamespaces = new ReportNamespaces();\n\n  if (!i18n) {\n    warnOnce('You will need to pass in an i18next instance by using initReactI18next');\n\n    var notReadyT = function notReadyT(k, optsOrDefaultValue) {\n      if (typeof optsOrDefaultValue === 'string') return optsOrDefaultValue;\n      if (optsOrDefaultValue && _typeof(optsOrDefaultValue) === 'object' && typeof optsOrDefaultValue.defaultValue === 'string') return optsOrDefaultValue.defaultValue;\n      return Array.isArray(k) ? k[k.length - 1] : k;\n    };\n\n    var retNotReady = [notReadyT, {}, false];\n    retNotReady.t = notReadyT;\n    retNotReady.i18n = {};\n    retNotReady.ready = false;\n    return retNotReady;\n  }\n\n  if (i18n.options.react && i18n.options.react.wait !== undefined) warnOnce('It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.');\n\n  var i18nOptions = _objectSpread(_objectSpread(_objectSpread({}, getDefaults()), i18n.options.react), props);\n\n  var useSuspense = i18nOptions.useSuspense,\n      keyPrefix = i18nOptions.keyPrefix;\n  var namespaces = ns || defaultNSFromContext || i18n.options && i18n.options.defaultNS;\n  namespaces = typeof namespaces === 'string' ? [namespaces] : namespaces || ['translation'];\n  if (i18n.reportNamespaces.addUsedNamespaces) i18n.reportNamespaces.addUsedNamespaces(namespaces);\n  var ready = (i18n.isInitialized || i18n.initializedStoreOnce) && namespaces.every(function (n) {\n    return hasLoadedNamespace(n, i18n, i18nOptions);\n  });\n\n  function getT() {\n    return i18n.getFixedT(props.lng || null, i18nOptions.nsMode === 'fallback' ? namespaces : namespaces[0], keyPrefix);\n  }\n\n  var _useState = useState(getT),\n      _useState2 = _slicedToArray(_useState, 2),\n      t = _useState2[0],\n      setT = _useState2[1];\n\n  var joinedNS = namespaces.join();\n  if (props.lng) joinedNS = \"\".concat(props.lng).concat(joinedNS);\n  var previousJoinedNS = usePrevious(joinedNS);\n  var isMounted = useRef(true);\n  useEffect(function () {\n    var bindI18n = i18nOptions.bindI18n,\n        bindI18nStore = i18nOptions.bindI18nStore;\n    isMounted.current = true;\n\n    if (!ready && !useSuspense) {\n      if (props.lng) {\n        loadLanguages(i18n, props.lng, namespaces, function () {\n          if (isMounted.current) setT(getT);\n        });\n      } else {\n        loadNamespaces(i18n, namespaces, function () {\n          if (isMounted.current) setT(getT);\n        });\n      }\n    }\n\n    if (ready && previousJoinedNS && previousJoinedNS !== joinedNS && isMounted.current) {\n      setT(getT);\n    }\n\n    function boundReset() {\n      if (isMounted.current) setT(getT);\n    }\n\n    if (bindI18n && i18n) i18n.on(bindI18n, boundReset);\n    if (bindI18nStore && i18n) i18n.store.on(bindI18nStore, boundReset);\n    return function () {\n      isMounted.current = false;\n      if (bindI18n && i18n) bindI18n.split(' ').forEach(function (e) {\n        return i18n.off(e, boundReset);\n      });\n      if (bindI18nStore && i18n) bindI18nStore.split(' ').forEach(function (e) {\n        return i18n.store.off(e, boundReset);\n      });\n    };\n  }, [i18n, joinedNS]);\n  var isInitial = useRef(true);\n  useEffect(function () {\n    if (isMounted.current && !isInitial.current) {\n      setT(getT);\n    }\n\n    isInitial.current = false;\n  }, [i18n, keyPrefix]);\n  var ret = [t, i18n, ready];\n  ret.t = t;\n  ret.i18n = i18n;\n  ret.ready = ready;\n  if (ready) return ret;\n  if (!ready && !useSuspense) return ret;\n  throw new Promise(function (resolve) {\n    if (props.lng) {\n      loadLanguages(i18n, props.lng, namespaces, function () {\n        return resolve();\n      });\n    } else {\n      loadNamespaces(i18n, namespaces, function () {\n        return resolve();\n      });\n    }\n  });\n}","export { Trans } from './Trans.js';\nexport { Trans as TransWithoutContext } from './TransWithoutContext.js';\nexport { useTranslation } from './useTranslation.js';\nexport { withTranslation } from './withTranslation.js';\nexport { Translation } from './Translation.js';\nexport { I18nextProvider } from './I18nextProvider.js';\nexport { withSSR } from './withSSR.js';\nexport { useSSR } from './useSSR.js';\nexport { initReactI18next } from './initReactI18next.js';\nexport { setDefaults, getDefaults } from './defaults.js';\nexport { setI18n, getI18n } from './i18nInstance.js';\nexport { I18nContext, composeInitialProps, getInitialProps } from './context.js';\nexport var date = function date() {\n  return '';\n};\nexport var time = function time() {\n  return '';\n};\nexport var number = function number() {\n  return '';\n};\nexport var select = function select() {\n  return '';\n};\nexport var plural = function plural() {\n  return '';\n};\nexport var selectOrdinal = function selectOrdinal() {\n  return '';\n};","import PropTypes from 'prop-types';\nimport React, { useCallback, useContext, useEffect, useState } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport OHIF, { utils, ServicesManager, ExtensionManager } from '@ohif/core';\n\nimport { setTrackingUniqueIdentifiersForElement } from '../tools/modules/dicomSRModule';\n\nimport { Icon, Tooltip, useViewportGrid, ViewportActionBar } from '@ohif/ui';\nimport hydrateStructuredReport from '../utils/hydrateStructuredReport';\n\nconst { formatDate } = utils;\n\nconst MEASUREMENT_TRACKING_EXTENSION_ID =\n  '@ohif/extension-measurement-tracking';\n\nconst SR_TOOLGROUP_BASE_NAME = 'SRToolGroup';\n\nfunction OHIFCornerstoneSRViewport(props) {\n  const {\n    children,\n    dataSource,\n    displaySets,\n    viewportIndex,\n    viewportLabel,\n    viewportOptions,\n    servicesManager,\n    extensionManager,\n  } = props;\n\n  const {\n    displaySetService,\n    cornerstoneViewportService,\n    measurementService,\n  } = servicesManager.services;\n\n  // SR viewport will always have a single display set\n  if (displaySets.length > 1) {\n    throw new Error('SR viewport should only have a single display set');\n  }\n\n  const srDisplaySet = displaySets[0];\n\n  const [viewportGrid, viewportGridService] = useViewportGrid();\n  const [measurementSelected, setMeasurementSelected] = useState(0);\n  const [measurementCount, setMeasurementCount] = useState(1);\n  const [activeImageDisplaySetData, setActiveImageDisplaySetData] = useState(\n    null\n  );\n  const [\n    referencedDisplaySetMetadata,\n    setReferencedDisplaySetMetadata,\n  ] = useState(null);\n  const [element, setElement] = useState(null);\n  const { viewports, activeViewportIndex } = viewportGrid;\n\n  // Optional hook into tracking extension, if present.\n  let trackedMeasurements;\n  let sendTrackedMeasurementsEvent;\n\n  const hasMeasurementTrackingExtension = extensionManager.registeredExtensionIds.includes(\n    MEASUREMENT_TRACKING_EXTENSION_ID\n  );\n\n  if (hasMeasurementTrackingExtension) {\n    const contextModule = extensionManager.getModuleEntry(\n      '@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext'\n    );\n\n    const tracked = useContext(contextModule.context);\n    trackedMeasurements = tracked?.[0];\n    sendTrackedMeasurementsEvent = tracked?.[1];\n  }\n  if (!sendTrackedMeasurementsEvent) {\n    // if no panels from measurement-tracking extension is used, this code will run\n    trackedMeasurements = null;\n    sendTrackedMeasurementsEvent = (eventName, { displaySetInstanceUID }) => {\n      measurementService.clearMeasurements();\n      const { SeriesInstanceUIDs } = hydrateStructuredReport(\n        { servicesManager, extensionManager },\n        displaySetInstanceUID\n      );\n      const displaySets = displaySetService.getDisplaySetsForSeries(\n        SeriesInstanceUIDs[0]\n      );\n      if (displaySets.length) {\n        viewportGridService.setDisplaySetsForViewports([\n          {\n            viewportIndex: activeViewportIndex,\n            displaySetInstanceUIDs: [displaySets[0].displaySetInstanceUID],\n          },\n        ]);\n      }\n    };\n  }\n\n  /**\n   * Store the tracking identifiers per viewport in order to be able to\n   * show the SR measurements on the referenced image on the correct viewport,\n   * when multiple viewports are used.\n   */\n  const setTrackingIdentifiers = useCallback(\n    measurementSelected => {\n      const { measurements } = srDisplaySet;\n\n      setTrackingUniqueIdentifiersForElement(\n        element,\n        measurements.map(measurement => measurement.TrackingUniqueIdentifier),\n        measurementSelected\n      );\n    },\n    [element, measurementSelected, srDisplaySet]\n  );\n\n  /**\n   * OnElementEnabled callback which is called after the cornerstoneExtension\n   * has enabled the element. Note: we delegate all the image rendering to\n   * cornerstoneExtension, so we don't need to do anything here regarding\n   * the image rendering, element enabling etc.\n   */\n  const onElementEnabled = evt => {\n    setElement(evt.detail.element);\n  };\n\n  const updateViewport = useCallback(\n    newMeasurementSelected => {\n      const {\n        StudyInstanceUID,\n        displaySetInstanceUID,\n        sopClassUids,\n      } = srDisplaySet;\n\n      if (!StudyInstanceUID || !displaySetInstanceUID) {\n        return;\n      }\n\n      if (sopClassUids && sopClassUids.length > 1) {\n        // Todo: what happens if there are multiple SOP Classes? Why we are\n        // not throwing an error?\n        console.warn(\n          'More than one SOPClassUID in the same series is not yet supported.'\n        );\n      }\n\n      _getViewportReferencedDisplaySetData(\n        srDisplaySet,\n        newMeasurementSelected,\n        displaySetService\n      ).then(({ referencedDisplaySet, referencedDisplaySetMetadata }) => {\n        setMeasurementSelected(newMeasurementSelected);\n        setActiveImageDisplaySetData(referencedDisplaySet);\n        setReferencedDisplaySetMetadata(referencedDisplaySetMetadata);\n\n        if (\n          referencedDisplaySet.displaySetInstanceUID ===\n          activeImageDisplaySetData?.displaySetInstanceUID\n        ) {\n          const { measurements } = srDisplaySet;\n\n          // it means that we have a new referenced display set, and the\n          // imageIdIndex will handle it by updating the viewport, but if they\n          // are the same we just need to use measurementService to jump to the\n          // new measurement\n          const viewportInfo = cornerstoneViewportService.getViewportInfoByIndex(\n            viewportIndex\n          );\n\n          const csViewport = cornerstoneViewportService.getCornerstoneViewport(\n            viewportInfo.getViewportId()\n          );\n\n          const imageIds = csViewport.getImageIds();\n\n          const imageIdIndex = imageIds.indexOf(\n            measurements[newMeasurementSelected].imageId\n          );\n\n          if (imageIdIndex !== -1) {\n            csViewport.setImageIdIndex(imageIdIndex);\n          }\n        }\n      });\n    },\n    [dataSource, srDisplaySet, activeImageDisplaySetData, viewportIndex]\n  );\n\n  const getCornerstoneViewport = useCallback(() => {\n    if (!activeImageDisplaySetData) {\n      return null;\n    }\n\n    const { component: Component } = extensionManager.getModuleEntry(\n      '@ohif/extension-cornerstone.viewportModule.cornerstone'\n    );\n\n    const { measurements } = srDisplaySet;\n    const measurement = measurements[measurementSelected];\n\n    if (!measurement) {\n      return null;\n    }\n\n    const initialImageIndex = activeImageDisplaySetData.images.findIndex(\n      image => image.imageId === measurement.imageId\n    );\n\n    return (\n      <Component\n        {...props}\n        // should be passed second since we don't want SR displaySet to\n        // override the activeImageDisplaySetData\n        displaySets={[activeImageDisplaySetData]}\n        // It is possible that there is a hanging protocol applying viewportOptions\n        // for the SR, so inherit the viewport options\n        // TODO: Ensure the viewport options are set correctly with respect to\n        // stack etc, in the incoming viewport options.\n        viewportOptions={{\n          ...viewportOptions,\n          toolGroupId: `${SR_TOOLGROUP_BASE_NAME}`,\n          // viewportType should not be required, as the stack type should be\n          // required already in order to view SR, but sometimes segmentation\n          // views set the viewport type without fixing the allowed display\n          viewportType: 'stack',\n          // The positionIds for the viewport aren't meaningful for the child display sets\n          positionIds: null,\n        }}\n        onElementEnabled={onElementEnabled}\n        initialImageIndex={initialImageIndex}\n      ></Component>\n    );\n  }, [activeImageDisplaySetData, viewportIndex, measurementSelected]);\n\n  const onMeasurementChange = useCallback(\n    direction => {\n      let newMeasurementSelected = measurementSelected;\n\n      if (direction === 'right') {\n        newMeasurementSelected++;\n\n        if (newMeasurementSelected >= measurementCount) {\n          newMeasurementSelected = 0;\n        }\n      } else {\n        newMeasurementSelected--;\n\n        if (newMeasurementSelected < 0) {\n          newMeasurementSelected = measurementCount - 1;\n        }\n      }\n\n      setTrackingIdentifiers(newMeasurementSelected);\n      updateViewport(newMeasurementSelected);\n    },\n    [\n      measurementSelected,\n      measurementCount,\n      updateViewport,\n      setTrackingIdentifiers,\n    ]\n  );\n\n  /**\n   Cleanup the SR viewport when the viewport is destroyed\n   */\n  useEffect(() => {\n    const onDisplaySetsRemovedSubscription = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_REMOVED,\n      ({ displaySetInstanceUIDs }) => {\n        const activeViewport = viewports[activeViewportIndex];\n        if (\n          displaySetInstanceUIDs.includes(activeViewport.displaySetInstanceUID)\n        ) {\n          viewportGridService.setDisplaySetsForViewport({\n            viewportIndex: activeViewportIndex,\n            displaySetInstanceUIDs: [],\n          });\n        }\n      }\n    );\n\n    return () => {\n      onDisplaySetsRemovedSubscription.unsubscribe();\n    };\n  }, []);\n\n  /**\n   * Loading the measurements from the SR viewport, which goes through the\n   * isHydratable check, the outcome for the isHydrated state here is always FALSE\n   * since we don't do the hydration here. Todo: can't we just set it as false? why\n   * we are changing the state here? isHydrated is always false at this stage, and\n   * if it is hydrated we don't even use the SR viewport.\n   */\n  useEffect(() => {\n    if (!srDisplaySet.isLoaded) {\n      srDisplaySet.load();\n    }\n    const numMeasurements = srDisplaySet.measurements.length;\n    setMeasurementCount(numMeasurements);\n  }, [srDisplaySet]);\n\n  /**\n   * Hook to update the tracking identifiers when the selected measurement changes or\n   * the element changes\n   */\n  useEffect(() => {\n    if (!element || !srDisplaySet.isLoaded) {\n      return;\n    }\n    setTrackingIdentifiers(measurementSelected);\n  }, [measurementSelected, element, setTrackingIdentifiers, srDisplaySet]);\n\n  /**\n   * Todo: what is this, not sure what it does regarding the react aspect,\n   * it is updating a local variable? which is not state.\n   */\n  let isLocked = trackedMeasurements?.context?.trackedSeries?.length > 0;\n  useEffect(() => {\n    isLocked = trackedMeasurements?.context?.trackedSeries?.length > 0;\n  }, [trackedMeasurements]);\n\n  /**\n   * Data fetching for the SR displaySet, which updates the measurements and\n   * also gets the referenced image displaySet that SR is based on.\n   */\n  useEffect(() => {\n    updateViewport(measurementSelected);\n  }, [dataSource, srDisplaySet]);\n\n  // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n  let childrenWithProps = null;\n\n  if (!activeImageDisplaySetData || !referencedDisplaySetMetadata) {\n    return null;\n  }\n\n  if (children && children.length) {\n    childrenWithProps = children.map((child, index) => {\n      return (\n        child &&\n        React.cloneElement(child, {\n          viewportIndex,\n          key: index,\n        })\n      );\n    });\n  }\n\n  const {\n    PatientID,\n    PatientName,\n    PatientSex,\n    PatientAge,\n    SliceThickness,\n    ManufacturerModelName,\n    StudyDate,\n    SeriesDescription,\n    SpacingBetweenSlices,\n    SeriesNumber,\n  } = referencedDisplaySetMetadata;\n\n  // TODO -> disabled double click for now: onDoubleClick={_onDoubleClick}\n  return (\n    <>\n      <ViewportActionBar\n        onDoubleClick={evt => {\n          evt.stopPropagation();\n          evt.preventDefault();\n        }}\n        onArrowsClick={onMeasurementChange}\n        getStatusComponent={() =>\n          _getStatusComponent({\n            srDisplaySet,\n            viewportIndex,\n            isTracked: false,\n            isRehydratable: srDisplaySet.isRehydratable,\n            isLocked,\n            sendTrackedMeasurementsEvent,\n          })\n        }\n        studyData={{\n          label: viewportLabel,\n          useAltStyling: true,\n          studyDate: formatDate(StudyDate),\n          currentSeries: SeriesNumber,\n          seriesDescription: SeriesDescription || '',\n          patientInformation: {\n            patientName: PatientName\n              ? OHIF.utils.formatPN(PatientName.Alphabetic)\n              : '',\n            patientSex: PatientSex || '',\n            patientAge: PatientAge || '',\n            MRN: PatientID || '',\n            thickness: SliceThickness ? `${SliceThickness.toFixed(2)}mm` : '',\n            spacing:\n              SpacingBetweenSlices !== undefined\n                ? `${SpacingBetweenSlices.toFixed(2)}mm`\n                : '',\n            scanner: ManufacturerModelName || '',\n          },\n        }}\n      />\n\n      <div className=\"relative flex flex-row w-full h-full overflow-hidden\">\n        {getCornerstoneViewport()}\n        {childrenWithProps}\n      </div>\n    </>\n  );\n}\n\nOHIFCornerstoneSRViewport.propTypes = {\n  displaySets: PropTypes.arrayOf(PropTypes.object),\n  viewportIndex: PropTypes.number.isRequired,\n  dataSource: PropTypes.object,\n  children: PropTypes.node,\n  viewportLabel: PropTypes.string,\n  customProps: PropTypes.object,\n  viewportOptions: PropTypes.object,\n  viewportLabel: PropTypes.string,\n  servicesManager: PropTypes.instanceOf(ServicesManager).isRequired,\n  extensionManager: PropTypes.instanceOf(ExtensionManager).isRequired,\n};\n\nOHIFCornerstoneSRViewport.defaultProps = {\n  customProps: {},\n};\n\nasync function _getViewportReferencedDisplaySetData(\n  displaySet,\n  measurementSelected,\n  displaySetService\n) {\n  const { measurements } = displaySet;\n  const measurement = measurements[measurementSelected];\n\n  const { displaySetInstanceUID } = measurement;\n\n  const referencedDisplaySet = displaySetService.getDisplaySetByUID(\n    displaySetInstanceUID\n  );\n\n  const image0 = referencedDisplaySet.images[0];\n  const referencedDisplaySetMetadata = {\n    PatientID: image0.PatientID,\n    PatientName: image0.PatientName,\n    PatientSex: image0.PatientSex,\n    PatientAge: image0.PatientAge,\n    SliceThickness: image0.SliceThickness,\n    StudyDate: image0.StudyDate,\n    SeriesDescription: image0.SeriesDescription,\n    SeriesInstanceUID: image0.SeriesInstanceUID,\n    SeriesNumber: image0.SeriesNumber,\n    ManufacturerModelName: image0.ManufacturerModelName,\n    SpacingBetweenSlices: image0.SpacingBetweenSlices,\n  };\n\n  return { referencedDisplaySetMetadata, referencedDisplaySet };\n}\n\nfunction _getStatusComponent({\n  srDisplaySet,\n  viewportIndex,\n  isRehydratable,\n  isLocked,\n  sendTrackedMeasurementsEvent,\n}) {\n  const handleMouseUp = () => {\n    sendTrackedMeasurementsEvent('HYDRATE_SR', {\n      displaySetInstanceUID: srDisplaySet.displaySetInstanceUID,\n      viewportIndex,\n    });\n  };\n\n  const { t } = useTranslation('Common');\n  const loadStr = t('LOAD');\n\n  // 1 - Incompatible\n  // 2 - Locked\n  // 3 - Rehydratable / Open\n  const state =\n    isRehydratable && !isLocked ? 3 : isRehydratable && isLocked ? 2 : 1;\n  let ToolTipMessage = null;\n  let StatusIcon = null;\n\n  switch (state) {\n    case 1:\n      StatusIcon = () => <Icon name=\"status-alert\" />;\n\n      ToolTipMessage = () => (\n        <div>\n          This structured report is not compatible\n          <br />\n          with this application.\n        </div>\n      );\n      break;\n    case 2:\n      StatusIcon = () => <Icon name=\"status-locked\" />;\n\n      ToolTipMessage = () => (\n        <div>\n          This structured report is currently read-only\n          <br />\n          because you are tracking measurements in\n          <br />\n          another viewport.\n        </div>\n      );\n      break;\n    case 3:\n      StatusIcon = () => <Icon name=\"status-untracked\" />;\n\n      ToolTipMessage = () => (\n        <div>{`Click ${loadStr} to restore measurements.`}</div>\n      );\n  }\n\n  const StatusArea = () => (\n    <div className=\"flex h-6 leading-6 cursor-default text-sm text-white\">\n      <div className=\"min-w-[45px] flex items-center p-1 rounded-l-xl rounded-r bg-customgray-100\">\n        <StatusIcon />\n        <span className=\"ml-1\">SR</span>\n      </div>\n      {state === 3 && (\n        <div\n          className=\"ml-1 px-1.5 rounded cursor-pointer hover:text-black bg-primary-main hover:bg-primary-light\"\n          // Using onMouseUp here because onClick is not working when the viewport is not active and is styled with pointer-events:none\n          onMouseUp={handleMouseUp}\n        >\n          {loadStr}\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <>\n      {ToolTipMessage && (\n        <Tooltip content={<ToolTipMessage />} position=\"bottom-left\">\n          <StatusArea />\n        </Tooltip>\n      )}\n      {!ToolTipMessage && <StatusArea />}\n    </>\n  );\n}\n\nexport default OHIFCornerstoneSRViewport;\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\nfunction emptyFunctionWithReset() {}\nemptyFunctionWithReset.resetWarningCache = emptyFunction;\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bigint: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    elementType: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim,\n\n    checkPropTypes: emptyFunctionWithReset,\n    resetWarningCache: emptyFunction\n  };\n\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var ReactIs = require('react-is');\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(ReactIs.isElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n","/** @license React v17.0.2\n * react.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var l=require(\"object-assign\"),n=60103,p=60106;exports.Fragment=60107;exports.StrictMode=60108;exports.Profiler=60114;var q=60109,r=60110,t=60112;exports.Suspense=60113;var u=60115,v=60116;\nif(\"function\"===typeof Symbol&&Symbol.for){var w=Symbol.for;n=w(\"react.element\");p=w(\"react.portal\");exports.Fragment=w(\"react.fragment\");exports.StrictMode=w(\"react.strict_mode\");exports.Profiler=w(\"react.profiler\");q=w(\"react.provider\");r=w(\"react.context\");t=w(\"react.forward_ref\");exports.Suspense=w(\"react.suspense\");u=w(\"react.memo\");v=w(\"react.lazy\")}var x=\"function\"===typeof Symbol&&Symbol.iterator;\nfunction y(a){if(null===a||\"object\"!==typeof a)return null;a=x&&a[x]||a[\"@@iterator\"];return\"function\"===typeof a?a:null}function z(a){for(var b=\"https://reactjs.org/docs/error-decoder.html?invariant=\"+a,c=1;c<arguments.length;c++)b+=\"&args[]=\"+encodeURIComponent(arguments[c]);return\"Minified React error #\"+a+\"; visit \"+b+\" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.\"}\nvar A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},B={};function C(a,b,c){this.props=a;this.context=b;this.refs=B;this.updater=c||A}C.prototype.isReactComponent={};C.prototype.setState=function(a,b){if(\"object\"!==typeof a&&\"function\"!==typeof a&&null!=a)throw Error(z(85));this.updater.enqueueSetState(this,a,b,\"setState\")};C.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,\"forceUpdate\")};\nfunction D(){}D.prototype=C.prototype;function E(a,b,c){this.props=a;this.context=b;this.refs=B;this.updater=c||A}var F=E.prototype=new D;F.constructor=E;l(F,C.prototype);F.isPureReactComponent=!0;var G={current:null},H=Object.prototype.hasOwnProperty,I={key:!0,ref:!0,__self:!0,__source:!0};\nfunction J(a,b,c){var e,d={},k=null,h=null;if(null!=b)for(e in void 0!==b.ref&&(h=b.ref),void 0!==b.key&&(k=\"\"+b.key),b)H.call(b,e)&&!I.hasOwnProperty(e)&&(d[e]=b[e]);var g=arguments.length-2;if(1===g)d.children=c;else if(1<g){for(var f=Array(g),m=0;m<g;m++)f[m]=arguments[m+2];d.children=f}if(a&&a.defaultProps)for(e in g=a.defaultProps,g)void 0===d[e]&&(d[e]=g[e]);return{$$typeof:n,type:a,key:k,ref:h,props:d,_owner:G.current}}\nfunction K(a,b){return{$$typeof:n,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function L(a){return\"object\"===typeof a&&null!==a&&a.$$typeof===n}function escape(a){var b={\"=\":\"=0\",\":\":\"=2\"};return\"$\"+a.replace(/[=:]/g,function(a){return b[a]})}var M=/\\/+/g;function N(a,b){return\"object\"===typeof a&&null!==a&&null!=a.key?escape(\"\"+a.key):b.toString(36)}\nfunction O(a,b,c,e,d){var k=typeof a;if(\"undefined\"===k||\"boolean\"===k)a=null;var h=!1;if(null===a)h=!0;else switch(k){case \"string\":case \"number\":h=!0;break;case \"object\":switch(a.$$typeof){case n:case p:h=!0}}if(h)return h=a,d=d(h),a=\"\"===e?\".\"+N(h,0):e,Array.isArray(d)?(c=\"\",null!=a&&(c=a.replace(M,\"$&/\")+\"/\"),O(d,b,c,\"\",function(a){return a})):null!=d&&(L(d)&&(d=K(d,c+(!d.key||h&&h.key===d.key?\"\":(\"\"+d.key).replace(M,\"$&/\")+\"/\")+a)),b.push(d)),1;h=0;e=\"\"===e?\".\":e+\":\";if(Array.isArray(a))for(var g=\n0;g<a.length;g++){k=a[g];var f=e+N(k,g);h+=O(k,b,c,f,d)}else if(f=y(a),\"function\"===typeof f)for(a=f.call(a),g=0;!(k=a.next()).done;)k=k.value,f=e+N(k,g++),h+=O(k,b,c,f,d);else if(\"object\"===k)throw b=\"\"+a,Error(z(31,\"[object Object]\"===b?\"object with keys {\"+Object.keys(a).join(\", \")+\"}\":b));return h}function P(a,b,c){if(null==a)return a;var e=[],d=0;O(a,e,\"\",\"\",function(a){return b.call(c,a,d++)});return e}\nfunction Q(a){if(-1===a._status){var b=a._result;b=b();a._status=0;a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}if(1===a._status)return a._result;throw a._result;}var R={current:null};function S(){var a=R.current;if(null===a)throw Error(z(321));return a}var T={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:G,IsSomeRendererActing:{current:!1},assign:l};\nexports.Children={map:P,forEach:function(a,b,c){P(a,function(){b.apply(this,arguments)},c)},count:function(a){var b=0;P(a,function(){b++});return b},toArray:function(a){return P(a,function(a){return a})||[]},only:function(a){if(!L(a))throw Error(z(143));return a}};exports.Component=C;exports.PureComponent=E;exports.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T;\nexports.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(z(267,a));var e=l({},a.props),d=a.key,k=a.ref,h=a._owner;if(null!=b){void 0!==b.ref&&(k=b.ref,h=G.current);void 0!==b.key&&(d=\"\"+b.key);if(a.type&&a.type.defaultProps)var g=a.type.defaultProps;for(f in b)H.call(b,f)&&!I.hasOwnProperty(f)&&(e[f]=void 0===b[f]&&void 0!==g?g[f]:b[f])}var f=arguments.length-2;if(1===f)e.children=c;else if(1<f){g=Array(f);for(var m=0;m<f;m++)g[m]=arguments[m+2];e.children=g}return{$$typeof:n,type:a.type,\nkey:d,ref:k,props:e,_owner:h}};exports.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:r,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:q,_context:a};return a.Consumer=a};exports.createElement=J;exports.createFactory=function(a){var b=J.bind(null,a);b.type=a;return b};exports.createRef=function(){return{current:null}};exports.forwardRef=function(a){return{$$typeof:t,render:a}};exports.isValidElement=L;\nexports.lazy=function(a){return{$$typeof:v,_payload:{_status:-1,_result:a},_init:Q}};exports.memo=function(a,b){return{$$typeof:u,type:a,compare:void 0===b?null:b}};exports.useCallback=function(a,b){return S().useCallback(a,b)};exports.useContext=function(a,b){return S().useContext(a,b)};exports.useDebugValue=function(){};exports.useEffect=function(a,b){return S().useEffect(a,b)};exports.useImperativeHandle=function(a,b,c){return S().useImperativeHandle(a,b,c)};\nexports.useLayoutEffect=function(a,b){return S().useLayoutEffect(a,b)};exports.useMemo=function(a,b){return S().useMemo(a,b)};exports.useReducer=function(a,b,c){return S().useReducer(a,b,c)};exports.useRef=function(a){return S().useRef(a)};exports.useState=function(a){return S().useState(a)};exports.version=\"17.0.2\";\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react.production.min.js');\n} else {\n  module.exports = require('./cjs/react.development.js');\n}\n","/**\n * This file automatically generated from `pre-publish.js`.\n * Do not manually edit.\n */\n\nmodule.exports = {\n  \"area\": true,\n  \"base\": true,\n  \"br\": true,\n  \"col\": true,\n  \"embed\": true,\n  \"hr\": true,\n  \"img\": true,\n  \"input\": true,\n  \"link\": true,\n  \"meta\": true,\n  \"param\": true,\n  \"source\": true,\n  \"track\": true,\n  \"wbr\": true\n};\n","module.exports = __WEBPACK_EXTERNAL_MODULE__32__;","module.exports = __WEBPACK_EXTERNAL_MODULE__464__;","module.exports = __WEBPACK_EXTERNAL_MODULE__867__;","module.exports = __WEBPACK_EXTERNAL_MODULE__762__;","module.exports = __WEBPACK_EXTERNAL_MODULE__369__;","module.exports = __WEBPACK_EXTERNAL_MODULE__836__;","module.exports = __WEBPACK_EXTERNAL_MODULE__845__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","__webpack_require__.F = {};\n__webpack_require__.E = (chunkId) => {\n\tObject.keys(__webpack_require__.F).map((key) => {\n\t\t__webpack_require__.F[key](chunkId);\n\t});\n}","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.O(0, [143], () => {\n\t__webpack_require__.E(143);\n}, 5);","import packageJson from '../package.json';\n\nconst id = packageJson.name;\n\nconst SOPClassHandlerName = 'dicom-sr';\nconst SOPClassHandlerId = `${id}.sopClassHandlerModule.${SOPClassHandlerName}`;\n\nexport { SOPClassHandlerName, SOPClassHandlerId, id };\n","export default {\n  POINT: 'POINT',\n  MULTIPOINT: 'MULTIPOINT',\n  POLYLINE: 'POLYLINE',\n  CIRCLE: 'CIRCLE',\n  ELLIPSE: 'ELLIPSE',\n};\n","import { Types, metaData, utilities as csUtils } from '@cornerstonejs/core';\nimport {\n  AnnotationTool,\n  annotation,\n  drawing,\n  utilities,\n  Types as cs3DToolsTypes,\n} from '@cornerstonejs/tools';\nimport { getTrackingUniqueIdentifiersForElement } from './modules/dicomSRModule';\nimport SCOORD_TYPES from '../constants/scoordTypes';\n\nexport default class DICOMSRDisplayTool extends AnnotationTool {\n  static toolName = 'DICOMSRDisplay';\n\n  constructor(\n    toolProps = {},\n    defaultToolProps = {\n      configuration: {},\n    }\n  ) {\n    super(toolProps, defaultToolProps);\n  }\n\n  _getTextBoxLinesFromLabels(labels) {\n    // TODO -> max 3 for now (label + shortAxis + longAxis), need a generic solution for this!\n\n    const labelLength = Math.min(labels.length, 3);\n    const lines = [];\n\n    for (let i = 0; i < labelLength; i++) {\n      const labelEntry = labels[i];\n      lines.push(`${_labelToShorthand(labelEntry.label)}${labelEntry.value}`);\n    }\n\n    return lines;\n  }\n\n  // This tool should not inherit from AnnotationTool and we should not need\n  // to add the following lines.\n  isPointNearTool = () => null;\n  getHandleNearImagePoint = () => null;\n\n  renderAnnotation = (\n    enabledElement: Types.IEnabledElement,\n    svgDrawingHelper: any\n  ): void => {\n    const { viewport } = enabledElement;\n    const { element } = viewport;\n\n    let annotations = annotation.state.getAnnotations(\n      this.getToolName(),\n      element\n    );\n\n    // Todo: We don't need this anymore, filtering happens in triggerAnnotationRender\n    if (!annotations?.length) {\n      return;\n    }\n\n    annotations = this.filterInteractableAnnotationsForElement(\n      element,\n      annotations\n    );\n\n    if (!annotations?.length) {\n      return;\n    }\n\n    const trackingUniqueIdentifiersForElement = getTrackingUniqueIdentifiersForElement(\n      element\n    );\n\n    const {\n      activeIndex,\n      trackingUniqueIdentifiers,\n    } = trackingUniqueIdentifiersForElement;\n\n    const activeTrackingUniqueIdentifier =\n      trackingUniqueIdentifiers[activeIndex];\n\n    // Filter toolData to only render the data for the active SR.\n    const filteredAnnotations = annotations.filter(annotation =>\n      trackingUniqueIdentifiers.includes(\n        annotation.data?.cachedStats?.TrackingUniqueIdentifier\n      )\n    );\n\n    if (!viewport._actors?.size) {\n      return;\n    }\n\n    const styleSpecifier: cs3DToolsTypes.AnnotationStyle.StyleSpecifier = {\n      toolGroupId: this.toolGroupId,\n      toolName: this.getToolName(),\n      viewportId: enabledElement.viewport.id,\n    };\n\n    for (let i = 0; i < filteredAnnotations.length; i++) {\n      const annotation = filteredAnnotations[i];\n      const annotationUID = annotation.annotationUID;\n      const { renderableData } = annotation.data.cachedStats;\n      const { cachedStats } = annotation.data;\n      const { referencedImageId } = annotation.metadata;\n\n      styleSpecifier.annotationUID = annotationUID;\n\n      const lineWidth = this.getStyle('lineWidth', styleSpecifier, annotation);\n      const lineDash = this.getStyle('lineDash', styleSpecifier, annotation);\n      const color =\n        cachedStats.TrackingUniqueIdentifier === activeTrackingUniqueIdentifier\n          ? 'rgb(0, 255, 0)'\n          : this.getStyle('color', styleSpecifier, annotation);\n\n      const options = {\n        color,\n        lineDash,\n        lineWidth,\n      };\n\n      Object.keys(renderableData).forEach(GraphicType => {\n        const renderableDataForGraphicType = renderableData[GraphicType];\n\n        let renderMethod;\n        let canvasCoordinatesAdapter;\n\n        switch (GraphicType) {\n          case SCOORD_TYPES.POINT:\n            renderMethod = this.renderPoint;\n            break;\n          case SCOORD_TYPES.MULTIPOINT:\n            renderMethod = this.renderMultipoint;\n            break;\n          case SCOORD_TYPES.POLYLINE:\n            renderMethod = this.renderPolyLine;\n            break;\n          case SCOORD_TYPES.CIRCLE:\n            renderMethod = this.renderEllipse;\n            break;\n          case SCOORD_TYPES.ELLIPSE:\n            renderMethod = this.renderEllipse;\n            canvasCoordinatesAdapter =\n              utilities.math.ellipse.getCanvasEllipseCorners;\n            break;\n          default:\n            throw new Error(`Unsupported GraphicType: ${GraphicType}`);\n        }\n\n        const canvasCoordinates = renderMethod(\n          svgDrawingHelper,\n          viewport,\n          renderableDataForGraphicType,\n          annotationUID,\n          referencedImageId,\n          options\n        );\n\n        this.renderTextBox(\n          svgDrawingHelper,\n          viewport,\n          canvasCoordinates,\n          canvasCoordinatesAdapter,\n          annotation,\n          styleSpecifier,\n          options\n        );\n      });\n    }\n  };\n\n  renderPolyLine(\n    svgDrawingHelper,\n    viewport,\n    renderableData,\n    annotationUID,\n    referencedImageId,\n    options\n  ) {\n    const drawingOptions = {\n      color: options.color,\n      width: options.lineWidth,\n    };\n    let allCanvasCoordinates = [];\n    renderableData.map((data, index) => {\n      const canvasCoordinates = data.map(p => viewport.worldToCanvas(p));\n      const lineUID = `${index}`;\n\n      if (canvasCoordinates.length === 2) {\n        drawing.drawLine(\n          svgDrawingHelper,\n          annotationUID,\n          lineUID,\n          canvasCoordinates[0],\n          canvasCoordinates[1],\n          drawingOptions\n        );\n      } else {\n        drawing.drawPolyline(\n          svgDrawingHelper,\n          annotationUID,\n          lineUID,\n          canvasCoordinates,\n          drawingOptions\n        );\n      }\n\n      allCanvasCoordinates = allCanvasCoordinates.concat(canvasCoordinates);\n    });\n\n    return allCanvasCoordinates; // used for drawing textBox\n  }\n\n  renderMultipoint(\n    svgDrawingHelper,\n    viewport,\n    renderableData,\n    annotationUID,\n    referencedImageId,\n    options\n  ) {\n    let canvasCoordinates;\n    renderableData.map((data, index) => {\n      canvasCoordinates = data.map(p => viewport.worldToCanvas(p));\n      const handleGroupUID = '0';\n      drawing.drawHandles(\n        svgDrawingHelper,\n        annotationUID,\n        handleGroupUID,\n        canvasCoordinates,\n        {\n          color: options.color,\n        }\n      );\n    });\n  }\n\n  renderPoint(\n    svgDrawingHelper,\n    viewport,\n    renderableData,\n    annotationUID,\n    referencedImageId,\n    options\n  ) {\n    const canvasCoordinates = [];\n    renderableData.map((data, index) => {\n      const point = data[0];\n      // This gives us one point for arrow\n      canvasCoordinates.push(viewport.worldToCanvas(point));\n\n      // We get the other point for the arrow by using the image size\n      const imagePixelModule = metaData.get(\n        'imagePixelModule',\n        referencedImageId\n      );\n\n      let xOffset = 10;\n      let yOffset = 10;\n\n      if (imagePixelModule) {\n        const { columns, rows } = imagePixelModule;\n        xOffset = columns / 10;\n        yOffset = rows / 10;\n      }\n\n      const imagePoint = csUtils.worldToImageCoords(referencedImageId, point);\n      const arrowEnd = csUtils.imageToWorldCoords(referencedImageId, [\n        imagePoint[0] + xOffset,\n        imagePoint[1] + yOffset,\n      ]);\n\n      canvasCoordinates.push(viewport.worldToCanvas(arrowEnd));\n\n      const arrowUID = `${index}`;\n\n      // Todo: handle drawing probe as probe, currently we are drawing it as an arrow\n      drawing.drawArrow(\n        svgDrawingHelper,\n        annotationUID,\n        arrowUID,\n        canvasCoordinates[1],\n        canvasCoordinates[0],\n        {\n          color: options.color,\n          width: options.lineWidth,\n        }\n      );\n    });\n\n    return canvasCoordinates; // used for drawing textBox\n  }\n\n  renderEllipse(\n    svgDrawingHelper,\n    viewport,\n    renderableData,\n    annotationUID,\n    referencedImageId,\n    options\n  ) {\n    let canvasCoordinates;\n    renderableData.map((data, index) => {\n      if (data.length === 0) {\n        // since oblique ellipse is not supported for hydration right now\n        // we just return\n        return;\n      }\n\n      const ellipsePointsWorld = data;\n\n      const rotation = viewport.getRotation();\n\n      canvasCoordinates = ellipsePointsWorld.map(p =>\n        viewport.worldToCanvas(p)\n      );\n      let canvasCorners;\n      if (rotation == 90 || rotation == 270) {\n        canvasCorners = <Array<Types.Point2>>(\n          utilities.math.ellipse.getCanvasEllipseCorners([\n            canvasCoordinates[2],\n            canvasCoordinates[3],\n            canvasCoordinates[0],\n            canvasCoordinates[1],\n          ])\n        );\n      } else {\n        canvasCorners = <Array<Types.Point2>>(\n          utilities.math.ellipse.getCanvasEllipseCorners(canvasCoordinates)\n        );\n      }\n\n      const lineUID = `${index}`;\n      drawing.drawEllipse(\n        svgDrawingHelper,\n        annotationUID,\n        lineUID,\n        canvasCorners[0],\n        canvasCorners[1],\n        {\n          color: options.color,\n          width: options.lineWidth,\n        }\n      );\n    });\n\n    return canvasCoordinates;\n  }\n\n  renderTextBox(\n    svgDrawingHelper,\n    viewport,\n    canvasCoordinates,\n    canvasCoordinatesAdapter,\n    annotation,\n    styleSpecifier,\n    options = {}\n  ) {\n    if (!canvasCoordinates || !annotation) {\n      return;\n    }\n\n    const { annotationUID, data = {} } = annotation;\n    const { label } = data;\n    const { color } = options;\n\n    let adaptedCanvasCoordinates = canvasCoordinates;\n    // adapt coordinates if there is an adapter\n    if (typeof canvasCoordinatesAdapter === 'function') {\n      adaptedCanvasCoordinates = canvasCoordinatesAdapter(canvasCoordinates);\n    }\n    const textLines = this._getTextBoxLinesFromLabels(label);\n    const canvasTextBoxCoords = utilities.drawing.getTextBoxCoordsCanvas(\n      adaptedCanvasCoordinates\n    );\n\n    annotation.data.handles.textBox.worldPosition = viewport.canvasToWorld(\n      canvasTextBoxCoords\n    );\n\n    const textBoxPosition = viewport.worldToCanvas(\n      annotation.data.handles.textBox.worldPosition\n    );\n\n    const textBoxUID = '1';\n    const textBoxOptions = this.getLinkedTextBoxStyle(\n      styleSpecifier,\n      annotation\n    );\n\n    const boundingBox = drawing.drawLinkedTextBox(\n      svgDrawingHelper,\n      annotationUID,\n      textBoxUID,\n      textLines,\n      textBoxPosition,\n      canvasCoordinates,\n      {},\n      {\n        ...textBoxOptions,\n        color,\n      }\n    );\n\n    const { x: left, y: top, width, height } = boundingBox;\n\n    annotation.data.handles.textBox.worldBoundingBox = {\n      topLeft: viewport.canvasToWorld([left, top]),\n      topRight: viewport.canvasToWorld([left + width, top]),\n      bottomLeft: viewport.canvasToWorld([left, top + height]),\n      bottomRight: viewport.canvasToWorld([left + width, top + height]),\n    };\n  }\n}\n\nconst SHORT_HAND_MAP = {\n  'Short Axis': 'W: ',\n  'Long Axis': 'L: ',\n  AREA: 'Area: ',\n  Length: '',\n  CORNERSTONEFREETEXT: '',\n};\n\nfunction _labelToShorthand(label) {\n  const shortHand = SHORT_HAND_MAP[label];\n\n  if (shortHand !== undefined) {\n    return shortHand;\n  }\n\n  return label;\n}\n","import DICOMSRDisplayTool from './DICOMSRDisplayTool';\n\nconst toolNames = {\n  DICOMSRDisplay: DICOMSRDisplayTool.toolName,\n  SRLength: 'SRLength',\n  SRBidirectional: 'SRBidirectional',\n  SREllipticalROI: 'SREllipticalROI',\n  SRCircleROI: 'SRCircleROI',\n  SRArrowAnnotate: 'SRArrowAnnotate',\n  SRAngle: 'SRAngle',\n  SRCobbAngle: 'SRCobbAngle',\n  SRRectangleROI: 'SRRectangleROI',\n  SRPlanarFreehandROI: 'SRPlanarFreehandROI',\n};\n\nexport default toolNames;\n","import { vec3 } from 'gl-matrix';\nimport { Types, annotation } from '@cornerstonejs/tools';\nimport { metaData, utilities, Types as csTypes } from '@cornerstonejs/core';\nimport toolNames from '../tools/toolNames';\nimport SCOORD_TYPES from '../constants/scoordTypes';\n\nconst EPSILON = 1e-4;\n\nconst supportedLegacyCornerstoneTags = ['cornerstoneTools@^4.0.0'];\n\nexport default function addMeasurement(\n  measurement,\n  imageId,\n  displaySetInstanceUID\n) {\n  // TODO -> Render rotated ellipse .\n  const toolName = toolNames.DICOMSRDisplay;\n\n  const measurementData = {\n    TrackingUniqueIdentifier: measurement.TrackingUniqueIdentifier,\n    renderableData: {},\n    labels: measurement.labels,\n    imageId,\n  };\n\n  measurement.coords.forEach(coord => {\n    const { GraphicType, GraphicData } = coord;\n\n    if (measurementData.renderableData[GraphicType] === undefined) {\n      measurementData.renderableData[GraphicType] = [];\n    }\n\n    measurementData.renderableData[GraphicType].push(\n      _getRenderableData(\n        GraphicType,\n        GraphicData,\n        imageId,\n        measurement.TrackingIdentifier\n      )\n    );\n  });\n\n  // Use the metadata provider to grab its imagePlaneModule metadata\n  const imagePlaneModule = metaData.get('imagePlaneModule', imageId);\n\n  const annotationManager = annotation.state.getAnnotationManager();\n\n  // Create Cornerstone3D Annotation from measurement\n  const frameNumber =\n    (measurement.coords[0].ReferencedSOPSequence &&\n      measurement.coords[0].ReferencedSOPSequence[0]?.ReferencedFrameNumber) ||\n    1;\n\n  const SRAnnotation: Types.Annotation = {\n    annotationUID: measurement.TrackingUniqueIdentifier,\n    metadata: {\n      FrameOfReferenceUID: imagePlaneModule.frameOfReferenceUID,\n      toolName: toolName,\n      referencedImageId: imageId,\n    },\n    data: {\n      label: measurement.labels,\n      handles: {\n        textBox: {},\n      },\n      cachedStats: {\n        TrackingUniqueIdentifier: measurementData.TrackingUniqueIdentifier,\n        renderableData: measurementData.renderableData,\n      },\n      frameNumber: frameNumber,\n    },\n  };\n\n  annotationManager.addAnnotation(SRAnnotation);\n\n  measurement.loaded = true;\n  measurement.imageId = imageId;\n  measurement.displaySetInstanceUID = displaySetInstanceUID;\n\n  // Remove the unneeded coord now its processed, but keep the SOPInstanceUID.\n  // NOTE: We assume that each SCOORD in the MeasurementGroup maps onto one frame,\n  // It'd be super weird if it didn't anyway as a SCOORD.\n  measurement.ReferencedSOPInstanceUID =\n    measurement.coords[0].ReferencedSOPSequence.ReferencedSOPInstanceUID;\n  measurement.frameNumber = frameNumber;\n  delete measurement.coords;\n}\n\nfunction _getRenderableData(\n  GraphicType,\n  GraphicData,\n  imageId,\n  TrackingIdentifier\n) {\n  const [cornerstoneTag, toolName] = TrackingIdentifier.split(':');\n\n  let renderableData: csTypes.Point3[];\n\n  switch (GraphicType) {\n    case SCOORD_TYPES.POINT:\n    case SCOORD_TYPES.MULTIPOINT:\n    case SCOORD_TYPES.POLYLINE:\n      renderableData = [];\n\n      for (let i = 0; i < GraphicData.length; i += 2) {\n        const worldPos = utilities.imageToWorldCoords(imageId, [\n          GraphicData[i],\n          GraphicData[i + 1],\n        ]);\n\n        renderableData.push(worldPos);\n      }\n\n      break;\n    case SCOORD_TYPES.CIRCLE: {\n      const pointsWorld = [];\n      for (let i = 0; i < GraphicData.length; i += 2) {\n        const worldPos = utilities.imageToWorldCoords(imageId, [\n          GraphicData[i],\n          GraphicData[i + 1],\n        ]);\n\n        pointsWorld.push(worldPos);\n      }\n\n      // We do not have an explicit draw circle svg helper in Cornerstone3D at\n      // this time, but we can use the ellipse svg helper to draw a circle, so\n      // here we reshape the data for that purpose.\n      const center = pointsWorld[0];\n      const onPerimeter = pointsWorld[1];\n\n      const radius = vec3.distance(center, onPerimeter);\n\n      const imagePlaneModule = metaData.get('imagePlaneModule', imageId);\n\n      if (!imagePlaneModule) {\n        throw new Error('No imagePlaneModule found');\n      }\n\n      const {\n        columnCosines,\n        rowCosines,\n      }: {\n        columnCosines: csTypes.Point3;\n        rowCosines: csTypes.Point3;\n      } = imagePlaneModule;\n\n      // we need to get major/minor axis (which are both the same size major = minor)\n\n      // first axisStart\n      const firstAxisStart = vec3.create();\n      vec3.scaleAndAdd(firstAxisStart, center, columnCosines, radius);\n\n      const firstAxisEnd = vec3.create();\n      vec3.scaleAndAdd(firstAxisEnd, center, columnCosines, -radius);\n\n      // second axisStart\n      const secondAxisStart = vec3.create();\n      vec3.scaleAndAdd(secondAxisStart, center, rowCosines, radius);\n\n      const secondAxisEnd = vec3.create();\n      vec3.scaleAndAdd(secondAxisEnd, center, rowCosines, -radius);\n\n      renderableData = [\n        firstAxisStart as csTypes.Point3,\n        firstAxisEnd as csTypes.Point3,\n        secondAxisStart as csTypes.Point3,\n        secondAxisEnd as csTypes.Point3,\n      ];\n\n      break;\n    }\n    case SCOORD_TYPES.ELLIPSE: {\n      // GraphicData is ordered as [majorAxisStartX, majorAxisStartY, majorAxisEndX, majorAxisEndY, minorAxisStartX, minorAxisStartY, minorAxisEndX, minorAxisEndY]\n      // But Cornerstone3D points are ordered as top, bottom, left, right for the\n      // ellipse so we need to identify if the majorAxis is horizontal or vertical\n      // and then choose the correct points to use for the ellipse.\n\n      const pointsWorld: csTypes.Point3[] = [];\n      for (let i = 0; i < GraphicData.length; i += 2) {\n        const worldPos = utilities.imageToWorldCoords(imageId, [\n          GraphicData[i],\n          GraphicData[i + 1],\n        ]);\n\n        pointsWorld.push(worldPos);\n      }\n\n      const majorAxisStart = vec3.fromValues(...pointsWorld[0]);\n      const majorAxisEnd = vec3.fromValues(...pointsWorld[1]);\n      const minorAxisStart = vec3.fromValues(...pointsWorld[2]);\n      const minorAxisEnd = vec3.fromValues(...pointsWorld[3]);\n\n      const majorAxisVec = vec3.create();\n      vec3.sub(majorAxisVec, majorAxisEnd, majorAxisStart);\n\n      // normalize majorAxisVec to avoid scaling issues\n      vec3.normalize(majorAxisVec, majorAxisVec);\n\n      const minorAxisVec = vec3.create();\n      vec3.sub(minorAxisVec, minorAxisEnd, minorAxisStart);\n      vec3.normalize(minorAxisVec, minorAxisVec);\n\n      const imagePlaneModule = metaData.get('imagePlaneModule', imageId);\n\n      if (!imagePlaneModule) {\n        throw new Error('imageId does not have imagePlaneModule metadata');\n      }\n\n      const {\n        columnCosines,\n      }: { columnCosines: csTypes.Point3 } = imagePlaneModule;\n\n      // find which axis is parallel to the columnCosines\n      const columnCosinesVec = vec3.fromValues(...columnCosines);\n\n      const projectedMajorAxisOnColVec = Math.abs(\n        vec3.dot(columnCosinesVec, majorAxisVec)\n      );\n      const projectedMinorAxisOnColVec = Math.abs(\n        vec3.dot(columnCosinesVec, minorAxisVec)\n      );\n\n      const absoluteOfMajorDotProduct = Math.abs(projectedMajorAxisOnColVec);\n      const absoluteOfMinorDotProduct = Math.abs(projectedMinorAxisOnColVec);\n\n      renderableData = [];\n      if (Math.abs(absoluteOfMajorDotProduct - 1) < EPSILON) {\n        renderableData = [\n          pointsWorld[0],\n          pointsWorld[1],\n          pointsWorld[2],\n          pointsWorld[3],\n        ];\n      } else if (Math.abs(absoluteOfMinorDotProduct - 1) < EPSILON) {\n        renderableData = [\n          pointsWorld[2],\n          pointsWorld[3],\n          pointsWorld[0],\n          pointsWorld[1],\n        ];\n      } else {\n        console.warn('OBLIQUE ELLIPSE NOT YET SUPPORTED');\n      }\n      break;\n    }\n    default:\n      console.warn('Unsupported GraphicType:', GraphicType);\n  }\n\n  return renderableData;\n}\n","import { adaptersSR } from '@cornerstonejs/adapters';\n\nconst cornerstoneAdapters =\n  adaptersSR.Cornerstone3D.MeasurementReport\n    .CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE;\n\nconst supportedLegacyCornerstoneTags = ['cornerstoneTools@^4.0.0'];\nconst CORNERSTONE_3D_TAG = cornerstoneAdapters.CORNERSTONE_3D_TAG;\n\n/**\n * Checks if the given `displaySet`can be rehydrated into the `measurementService`.\n *\n * @param {object} displaySet The SR `displaySet` to check.\n * @param {object[]} mappings The CornerstoneTools 4 mappings to the `measurementService`.\n * @returns {boolean} True if the SR can be rehydrated into the `measurementService`.\n */\nexport default function isRehydratable(displaySet, mappings) {\n  if (!mappings || !mappings.length) {\n    return false;\n  }\n\n  const mappingDefinitions = mappings.map(m => m.annotationType);\n  const { measurements } = displaySet;\n\n  const adapterKeys = Object.keys(cornerstoneAdapters).filter(\n    adapterKey =>\n      typeof cornerstoneAdapters[adapterKey]\n        .isValidCornerstoneTrackingIdentifier === 'function'\n  );\n\n  const adapters = [];\n\n  adapterKeys.forEach(key => {\n    if (mappingDefinitions.includes(key)) {\n      // Must have both a dcmjs adapter and a measurementService\n      // Definition in order to be a candidate for import.\n      adapters.push(cornerstoneAdapters[key]);\n    }\n  });\n\n  for (let i = 0; i < measurements.length; i++) {\n    const { TrackingIdentifier } = measurements[i] || {};\n    const hydratable = adapters.some(adapter => {\n      let [cornerstoneTag, toolName] = TrackingIdentifier.split(':');\n      if (supportedLegacyCornerstoneTags.includes(cornerstoneTag)) {\n        cornerstoneTag = CORNERSTONE_3D_TAG;\n      }\n\n      const mappedTrackingIdentifier = `${cornerstoneTag}:${toolName}`;\n\n      return adapter.isValidCornerstoneTrackingIdentifier(\n        mappedTrackingIdentifier\n      );\n    });\n\n    if (hydratable) {\n      return true;\n    }\n    console.log(\n      'Measurement is not rehydratable',\n      TrackingIdentifier,\n      measurements[i]\n    );\n  }\n\n  console.log('No measurements found which were rehydratable');\n  return false;\n}\n","import { SOPClassHandlerName, SOPClassHandlerId } from './id';\nimport { utils, classes, DisplaySetService, Types } from '@ohif/core';\nimport addMeasurement from './utils/addMeasurement';\nimport isRehydratable from './utils/isRehydratable';\nimport { adaptersSR } from '@cornerstonejs/adapters';\n\ntype InstanceMetadata = Types.InstanceMetadata;\n\nconst { CodeScheme: Cornerstone3DCodeScheme } = adaptersSR.Cornerstone3D;\n\nconst { ImageSet, MetadataProvider: metadataProvider } = classes;\n\n// TODO ->\n// Add SR thumbnail\n// Make viewport\n// Get stacks from referenced displayInstanceUID and load into wrapped CornerStone viewport.\n\nconst sopClassUids = [\n  '1.2.840.10008.5.1.4.1.1.88.11', //BASIC_TEXT_SR:\n  '1.2.840.10008.5.1.4.1.1.88.22', //ENHANCED_SR:\n  '1.2.840.10008.5.1.4.1.1.88.33', //COMPREHENSIVE_SR:\n  '1.2.840.10008.5.1.4.1.1.88.34', //COMPREHENSIVE_3D_SR:\n];\n\nconst CORNERSTONE_3D_TOOLS_SOURCE_NAME = 'Cornerstone3DTools';\nconst CORNERSTONE_3D_TOOLS_SOURCE_VERSION = '0.1';\n\nconst validateSameStudyUID = (uid: string, instances): void => {\n  instances.forEach(it => {\n    if (it.StudyInstanceUID !== uid) {\n      console.warn('Not all instances have the same UID', uid, it);\n      throw new Error(\n        `Instances ${it.SOPInstanceUID} does not belong to ${uid}`\n      );\n    }\n  });\n};\n\nconst CodeNameCodeSequenceValues = {\n  ImagingMeasurementReport: '126000',\n  ImageLibrary: '111028',\n  ImagingMeasurements: '126010',\n  MeasurementGroup: '125007',\n  ImageLibraryGroup: '126200',\n  TrackingUniqueIdentifier: '112040',\n  TrackingIdentifier: '112039',\n  Finding: '121071',\n  FindingSite: 'G-C0E3', // SRT\n  CornerstoneFreeText: Cornerstone3DCodeScheme.codeValues.CORNERSTONEFREETEXT, //\n};\n\nconst CodingSchemeDesignators = {\n  SRT: 'SRT',\n  CornerstoneCodeSchemes: [\n    Cornerstone3DCodeScheme.CodingSchemeDesignator,\n    'CST4',\n  ],\n};\n\nconst RELATIONSHIP_TYPE = {\n  INFERRED_FROM: 'INFERRED FROM',\n  CONTAINS: 'CONTAINS',\n};\n\nconst CORNERSTONE_FREETEXT_CODE_VALUE = 'CORNERSTONEFREETEXT';\n\n/**\n * Adds instances to the DICOM SR series, rather than creating a new\n * series, so that as SR's are saved, they append to the series, and the\n * key image display set gets updated as well, containing just the new series.\n * @param instances is a list of instances from THIS series that are not\n *     in this DICOM SR Display Set already.\n */\nfunction addInstances(\n  instances: InstanceMetadata[],\n  displaySetService: DisplaySetService\n) {\n  this.instances.push(...instances);\n  utils.sortStudyInstances(this.instances);\n  // The last instance is the newest one, so is the one most interesting.\n  // Eventually, the SR viewer should have the ability to choose which SR\n  // gets loaded, and to navigate among them.\n  this.instance = this.instances[this.instances.length - 1];\n  this.isLoaded = false;\n  return this;\n}\n\n/**\n * DICOM SR SOP Class Handler\n * For all referenced images in the TID 1500/300 sections, add an image to the\n * display.\n * @param instances is a set of instances all from the same series\n * @param servicesManager is the services that can be used for creating\n * @returns The list of display sets created for the given instances object\n */\nfunction _getDisplaySetsFromSeries(\n  instances,\n  servicesManager,\n  extensionManager\n) {\n  // If the series has no instances, stop here\n  if (!instances || !instances.length) {\n    throw new Error('No instances were provided');\n  }\n\n  utils.sortStudyInstances(instances);\n  // The last instance is the newest one, so is the one most interesting.\n  // Eventually, the SR viewer should have the ability to choose which SR\n  // gets loaded, and to navigate among them.\n  const instance = instances[instances.length - 1];\n\n  const {\n    StudyInstanceUID,\n    SeriesInstanceUID,\n    SOPInstanceUID,\n    SeriesDescription,\n    SeriesNumber,\n    SeriesDate,\n    ConceptNameCodeSequence,\n    SOPClassUID,\n  } = instance;\n  validateSameStudyUID(instance.StudyInstanceUID, instances);\n\n  if (\n    !ConceptNameCodeSequence ||\n    ConceptNameCodeSequence.CodeValue !==\n      CodeNameCodeSequenceValues.ImagingMeasurementReport\n  ) {\n    servicesManager.services.uiNotificationService.show({\n      title: 'DICOM SR',\n      message:\n        'OHIF only supports TID1500 Imaging Measurement Report Structured Reports. The SR youre trying to view is not supported.',\n      type: 'warning',\n      duration: 6000,\n    });\n    return [];\n  }\n\n  const displaySet = {\n    //plugin: id,\n    Modality: 'SR',\n    displaySetInstanceUID: utils.guid(),\n    SeriesDescription,\n    SeriesNumber,\n    SeriesDate,\n    SOPInstanceUID,\n    SeriesInstanceUID,\n    StudyInstanceUID,\n    SOPClassHandlerId,\n    SOPClassUID,\n    instances,\n    referencedImages: null,\n    measurements: null,\n    isDerivedDisplaySet: true,\n    isLoaded: false,\n    sopClassUids,\n    instance,\n    addInstances,\n  };\n\n  displaySet.load = () => _load(displaySet, servicesManager, extensionManager);\n\n  return [displaySet];\n}\n\nfunction _load(displaySet, servicesManager, extensionManager) {\n  const { displaySetService, measurementService } = servicesManager.services;\n  const dataSources = extensionManager.getDataSources();\n  const dataSource = dataSources[0];\n\n  const { ContentSequence } = displaySet.instance;\n\n  displaySet.referencedImages = _getReferencedImagesList(ContentSequence);\n  displaySet.measurements = _getMeasurements(ContentSequence);\n\n  const mappings = measurementService.getSourceMappings(\n    CORNERSTONE_3D_TOOLS_SOURCE_NAME,\n    CORNERSTONE_3D_TOOLS_SOURCE_VERSION\n  );\n\n  displaySet.isHydrated = false;\n  displaySet.isRehydratable = isRehydratable(displaySet, mappings);\n  displaySet.isLoaded = true;\n\n  // Check currently added displaySets and add measurements if the sources exist.\n  displaySetService.activeDisplaySets.forEach(activeDisplaySet => {\n    _checkIfCanAddMeasurementsToDisplaySet(\n      displaySet,\n      activeDisplaySet,\n      dataSource\n    );\n  });\n\n  // Subscribe to new displaySets as the source may come in after.\n  displaySetService.subscribe(\n    displaySetService.EVENTS.DISPLAY_SETS_ADDED,\n    data => {\n      const { displaySetsAdded } = data;\n      // If there are still some measurements that have not yet been loaded into cornerstone,\n      // See if we can load them onto any of the new displaySets.\n      displaySetsAdded.forEach(newDisplaySet => {\n        _checkIfCanAddMeasurementsToDisplaySet(\n          displaySet,\n          newDisplaySet,\n          dataSource\n        );\n      });\n    }\n  );\n}\n\nfunction _checkIfCanAddMeasurementsToDisplaySet(\n  srDisplaySet,\n  newDisplaySet,\n  dataSource\n) {\n  let unloadedMeasurements = srDisplaySet.measurements.filter(\n    measurement => measurement.loaded === false\n  );\n\n  if (unloadedMeasurements.length === 0) {\n    // All already loaded!\n    return;\n  }\n\n  if (!newDisplaySet instanceof ImageSet) {\n    // This also filters out _this_ displaySet, as it is not an ImageSet.\n    return;\n  }\n\n  const { sopClassUids, images } = newDisplaySet;\n\n  // Check if any have the newDisplaySet is the correct SOPClass.\n  unloadedMeasurements = unloadedMeasurements.filter(measurement =>\n    measurement.coords.some(coord =>\n      sopClassUids.includes(coord.ReferencedSOPSequence.ReferencedSOPClassUID)\n    )\n  );\n\n  if (unloadedMeasurements.length === 0) {\n    // New displaySet isn't the correct SOPClass, so can't contain the referenced images.\n    return;\n  }\n\n  const SOPInstanceUIDs = [];\n\n  unloadedMeasurements.forEach(measurement => {\n    const { coords } = measurement;\n\n    coords.forEach(coord => {\n      const SOPInstanceUID =\n        coord.ReferencedSOPSequence.ReferencedSOPInstanceUID;\n\n      if (!SOPInstanceUIDs.includes(SOPInstanceUID)) {\n        SOPInstanceUIDs.push(SOPInstanceUID);\n      }\n    });\n  });\n\n  const imageIdsForDisplaySet = dataSource.getImageIdsForDisplaySet(\n    newDisplaySet\n  );\n\n  for (const imageId of imageIdsForDisplaySet) {\n    if (!unloadedMeasurements.length) {\n      // All measurements loaded.\n      return;\n    }\n\n    const { SOPInstanceUID, frameNumber } = metadataProvider.getUIDsFromImageID(\n      imageId\n    );\n\n    if (SOPInstanceUIDs.includes(SOPInstanceUID)) {\n      for (let j = unloadedMeasurements.length - 1; j >= 0; j--) {\n        const measurement = unloadedMeasurements[j];\n        if (\n          _measurementReferencesSOPInstanceUID(\n            measurement,\n            SOPInstanceUID,\n            frameNumber\n          )\n        ) {\n          addMeasurement(\n            measurement,\n            imageId,\n            newDisplaySet.displaySetInstanceUID\n          );\n\n          unloadedMeasurements.splice(j, 1);\n        }\n      }\n    }\n  }\n}\n\nfunction _measurementReferencesSOPInstanceUID(\n  measurement,\n  SOPInstanceUID,\n  frameNumber\n) {\n  const { coords } = measurement;\n\n  // NOTE: The ReferencedFrameNumber can be multiple values according to the DICOM\n  //  Standard. But for now, we will support only one ReferenceFrameNumber.\n  const ReferencedFrameNumber =\n    (measurement.coords[0].ReferencedSOPSequence &&\n      measurement.coords[0].ReferencedSOPSequence[0]?.ReferencedFrameNumber) ||\n    1;\n\n  if (frameNumber && Number(frameNumber) !== Number(ReferencedFrameNumber))\n    return false;\n\n  for (let j = 0; j < coords.length; j++) {\n    const coord = coords[j];\n    const { ReferencedSOPInstanceUID } = coord.ReferencedSOPSequence;\n\n    if (ReferencedSOPInstanceUID === SOPInstanceUID) {\n      return true;\n    }\n  }\n}\n\nfunction getSopClassHandlerModule({ servicesManager, extensionManager }) {\n  const getDisplaySetsFromSeries = instances => {\n    return _getDisplaySetsFromSeries(\n      instances,\n      servicesManager,\n      extensionManager\n    );\n  };\n\n  return [\n    {\n      name: SOPClassHandlerName,\n      sopClassUids,\n      getDisplaySetsFromSeries,\n    },\n  ];\n}\n\nfunction _getMeasurements(ImagingMeasurementReportContentSequence) {\n  const ImagingMeasurements = ImagingMeasurementReportContentSequence.find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.ImagingMeasurements\n  );\n\n  const MeasurementGroups = _getSequenceAsArray(\n    ImagingMeasurements.ContentSequence\n  ).filter(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.MeasurementGroup\n  );\n\n  const mergedContentSequencesByTrackingUniqueIdentifiers = _getMergedContentSequencesByTrackingUniqueIdentifiers(\n    MeasurementGroups\n  );\n\n  const measurements = [];\n\n  Object.keys(mergedContentSequencesByTrackingUniqueIdentifiers).forEach(\n    trackingUniqueIdentifier => {\n      const mergedContentSequence =\n        mergedContentSequencesByTrackingUniqueIdentifiers[\n          trackingUniqueIdentifier\n        ];\n\n      const measurement = _processMeasurement(mergedContentSequence);\n\n      if (measurement) {\n        measurements.push(measurement);\n      }\n    }\n  );\n\n  return measurements;\n}\n\nfunction _getMergedContentSequencesByTrackingUniqueIdentifiers(\n  MeasurementGroups\n) {\n  const mergedContentSequencesByTrackingUniqueIdentifiers = {};\n\n  MeasurementGroups.forEach(MeasurementGroup => {\n    const ContentSequence = _getSequenceAsArray(\n      MeasurementGroup.ContentSequence\n    );\n\n    const TrackingUniqueIdentifierItem = ContentSequence.find(\n      item =>\n        item.ConceptNameCodeSequence.CodeValue ===\n        CodeNameCodeSequenceValues.TrackingUniqueIdentifier\n    );\n\n    if (!TrackingUniqueIdentifierItem) {\n      console.warn(\n        'No Tracking Unique Identifier, skipping ambiguous measurement.'\n      );\n    }\n\n    const trackingUniqueIdentifier = TrackingUniqueIdentifierItem.UID;\n\n    if (\n      mergedContentSequencesByTrackingUniqueIdentifiers[\n        trackingUniqueIdentifier\n      ] === undefined\n    ) {\n      // Add the full ContentSequence\n      mergedContentSequencesByTrackingUniqueIdentifiers[\n        trackingUniqueIdentifier\n      ] = [...ContentSequence];\n    } else {\n      // Add the ContentSequence minus the tracking identifier, as we have this\n      // Information in the merged ContentSequence anyway.\n      ContentSequence.forEach(item => {\n        if (\n          item.ConceptNameCodeSequence.CodeValue !==\n          CodeNameCodeSequenceValues.TrackingUniqueIdentifier\n        ) {\n          mergedContentSequencesByTrackingUniqueIdentifiers[\n            trackingUniqueIdentifier\n          ].push(item);\n        }\n      });\n    }\n  });\n\n  return mergedContentSequencesByTrackingUniqueIdentifiers;\n}\n\nfunction _processMeasurement(mergedContentSequence) {\n  if (\n    mergedContentSequence.some(\n      group => group.ValueType === 'SCOORD' || group.ValueType === 'SCOORD3D'\n    )\n  ) {\n    return _processTID1410Measurement(mergedContentSequence);\n  }\n\n  return _processNonGeometricallyDefinedMeasurement(mergedContentSequence);\n}\n\nfunction _processTID1410Measurement(mergedContentSequence) {\n  // Need to deal with TID 1410 style measurements, which will have a SCOORD or SCOORD3D at the top level,\n  // And non-geometric representations where each NUM has \"INFERRED FROM\" SCOORD/SCOORD3D\n\n  const graphicItem = mergedContentSequence.find(\n    group => group.ValueType === 'SCOORD'\n  );\n\n  const UIDREFContentItem = mergedContentSequence.find(\n    group => group.ValueType === 'UIDREF'\n  );\n\n  const TrackingIdentifierContentItem = mergedContentSequence.find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.TrackingIdentifier\n  );\n\n  if (!graphicItem) {\n    console.warn(\n      `graphic ValueType ${graphicItem.ValueType} not currently supported, skipping annotation.`\n    );\n    return;\n  }\n\n  const NUMContentItems = mergedContentSequence.filter(\n    group => group.ValueType === 'NUM'\n  );\n\n  const measurement = {\n    loaded: false,\n    labels: [],\n    coords: [_getCoordsFromSCOORDOrSCOORD3D(graphicItem)],\n    TrackingUniqueIdentifier: UIDREFContentItem.UID,\n    TrackingIdentifier: TrackingIdentifierContentItem.TextValue,\n  };\n\n  NUMContentItems.forEach(item => {\n    const { ConceptNameCodeSequence, MeasuredValueSequence } = item;\n\n    if (MeasuredValueSequence) {\n      measurement.labels.push(\n        _getLabelFromMeasuredValueSequence(\n          ConceptNameCodeSequence,\n          MeasuredValueSequence\n        )\n      );\n    }\n  });\n\n  return measurement;\n}\n\nfunction _processNonGeometricallyDefinedMeasurement(mergedContentSequence) {\n  const NUMContentItems = mergedContentSequence.filter(\n    group => group.ValueType === 'NUM'\n  );\n\n  const UIDREFContentItem = mergedContentSequence.find(\n    group => group.ValueType === 'UIDREF'\n  );\n\n  const TrackingIdentifierContentItem = mergedContentSequence.find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.TrackingIdentifier\n  );\n\n  const finding = mergedContentSequence.find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.Finding\n  );\n\n  const findingSites = mergedContentSequence.filter(\n    item =>\n      item.ConceptNameCodeSequence.CodingSchemeDesignator ===\n        CodingSchemeDesignators.SRT &&\n      item.ConceptNameCodeSequence.CodeValue ===\n        CodeNameCodeSequenceValues.FindingSite\n  );\n\n  const measurement = {\n    loaded: false,\n    labels: [],\n    coords: [],\n    TrackingUniqueIdentifier: UIDREFContentItem.UID,\n    TrackingIdentifier: TrackingIdentifierContentItem.TextValue,\n  };\n\n  if (\n    finding &&\n    CodingSchemeDesignators.CornerstoneCodeSchemes.includes(\n      finding.ConceptCodeSequence.CodingSchemeDesignator\n    ) &&\n    finding.ConceptCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.CornerstoneFreeText\n  ) {\n    measurement.labels.push({\n      label: CORNERSTONE_FREETEXT_CODE_VALUE,\n      value: finding.ConceptCodeSequence.CodeMeaning,\n    });\n  }\n\n  // TODO -> Eventually hopefully support SNOMED or some proper code library, just free text for now.\n  if (findingSites.length) {\n    const cornerstoneFreeTextFindingSite = findingSites.find(\n      FindingSite =>\n        CodingSchemeDesignators.CornerstoneCodeSchemes.includes(\n          FindingSite.ConceptCodeSequence.CodingSchemeDesignator\n        ) &&\n        FindingSite.ConceptCodeSequence.CodeValue ===\n          CodeNameCodeSequenceValues.CornerstoneFreeText\n    );\n\n    if (cornerstoneFreeTextFindingSite) {\n      measurement.labels.push({\n        label: CORNERSTONE_FREETEXT_CODE_VALUE,\n        value: cornerstoneFreeTextFindingSite.ConceptCodeSequence.CodeMeaning,\n      });\n    }\n  }\n\n  NUMContentItems.forEach(item => {\n    const {\n      ConceptNameCodeSequence,\n      ContentSequence,\n      MeasuredValueSequence,\n    } = item;\n\n    const { ValueType } = ContentSequence;\n\n    if (!ValueType === 'SCOORD') {\n      console.warn(\n        `Graphic ${ValueType} not currently supported, skipping annotation.`\n      );\n\n      return;\n    }\n\n    const coords = _getCoordsFromSCOORDOrSCOORD3D(ContentSequence);\n\n    if (coords) {\n      measurement.coords.push(coords);\n    }\n\n    if (MeasuredValueSequence) {\n      measurement.labels.push(\n        _getLabelFromMeasuredValueSequence(\n          ConceptNameCodeSequence,\n          MeasuredValueSequence\n        )\n      );\n    }\n  });\n\n  return measurement;\n}\n\nfunction _getCoordsFromSCOORDOrSCOORD3D(item) {\n  const { ValueType, RelationshipType, GraphicType, GraphicData } = item;\n\n  if (\n    !(\n      RelationshipType == RELATIONSHIP_TYPE.INFERRED_FROM ||\n      RelationshipType == RELATIONSHIP_TYPE.CONTAINS\n    )\n  ) {\n    console.warn(\n      `Relationshiptype === ${RelationshipType}. Cannot deal with NON TID-1400 SCOORD group with RelationshipType !== \"INFERRED FROM\" or \"CONTAINS\"`\n    );\n\n    return;\n  }\n\n  const coords = { ValueType, GraphicType, GraphicData };\n\n  // ContentSequence has length of 1 as RelationshipType === 'INFERRED FROM'\n  if (ValueType === 'SCOORD') {\n    const { ReferencedSOPSequence } = item.ContentSequence;\n\n    coords.ReferencedSOPSequence = ReferencedSOPSequence;\n  } else if (ValueType === 'SCOORD3D') {\n    const { ReferencedFrameOfReferenceSequence } = item.ContentSequence;\n\n    coords.ReferencedFrameOfReferenceSequence = ReferencedFrameOfReferenceSequence;\n  }\n\n  return coords;\n}\n\nfunction _getLabelFromMeasuredValueSequence(\n  ConceptNameCodeSequence,\n  MeasuredValueSequence\n) {\n  const { CodeMeaning } = ConceptNameCodeSequence;\n  const { NumericValue, MeasurementUnitsCodeSequence } = MeasuredValueSequence;\n  const { CodeValue } = MeasurementUnitsCodeSequence;\n\n  const formatedNumericValue = NumericValue\n    ? Number(NumericValue).toFixed(2)\n    : '';\n\n  return {\n    label: CodeMeaning,\n    value: `${formatedNumericValue} ${CodeValue}`,\n  }; // E.g. Long Axis: 31.0 mm\n}\n\nfunction _getReferencedImagesList(ImagingMeasurementReportContentSequence) {\n  const ImageLibrary = ImagingMeasurementReportContentSequence.find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.ImageLibrary\n  );\n\n  const ImageLibraryGroup = _getSequenceAsArray(\n    ImageLibrary.ContentSequence\n  ).find(\n    item =>\n      item.ConceptNameCodeSequence.CodeValue ===\n      CodeNameCodeSequenceValues.ImageLibraryGroup\n  );\n\n  const referencedImages = [];\n\n  _getSequenceAsArray(ImageLibraryGroup.ContentSequence).forEach(item => {\n    const { ReferencedSOPSequence } = item;\n    if (!ReferencedSOPSequence) return;\n    for (const ref of _getSequenceAsArray(ReferencedSOPSequence)) {\n      if (ref.ReferencedSOPClassUID) {\n        const { ReferencedSOPClassUID, ReferencedSOPInstanceUID } = ref;\n\n        referencedImages.push({\n          ReferencedSOPClassUID,\n          ReferencedSOPInstanceUID,\n        });\n      }\n    }\n  });\n\n  return referencedImages;\n}\n\nfunction _getSequenceAsArray(sequence) {\n  if (!sequence) return [];\n  return Array.isArray(sequence) ? sequence : [sequence];\n}\n\nexport default getSopClassHandlerModule;\n","import { Types } from '@ohif/core';\n\nconst srProtocol: Types.HangingProtocol.Protocol = {\n  id: '@ohif/sr',\n  // Don't store this hanging protocol as it applies to the currently active\n  // display set by default\n  // cacheId: null,\n  hasUpdatedPriorsInformation: false,\n  name: 'SR Key Images',\n  // Just apply this one when specifically listed\n  protocolMatchingRules: [],\n  toolGroupIds: ['default'],\n  // -1 would be used to indicate active only, whereas other values are\n  // the number of required priors referenced - so 0 means active with\n  // 0 or more priors.\n  numberOfPriorsReferenced: 0,\n  // Default viewport is used to define the viewport when\n  // additional viewports are added using the layout tool\n  defaultViewport: {\n    viewportOptions: {\n      viewportType: 'stack',\n      toolGroupId: 'default',\n      allowUnmatchedView: true,\n    },\n    displaySets: [\n      {\n        id: 'srDisplaySetId',\n        matchedDisplaySetsIndex: -1,\n      },\n    ],\n  },\n  displaySetSelectors: {\n    srDisplaySetId: {\n      seriesMatchingRules: [\n        {\n          attribute: 'Modality',\n          constraint: {\n            equals: 'SR',\n          },\n        },\n      ],\n    },\n  },\n  stages: [\n    {\n      name: 'SR Key Images',\n      viewportStructure: {\n        layoutType: 'grid',\n        properties: {\n          rows: 1,\n          columns: 1,\n        },\n      },\n      viewports: [\n        {\n          viewportOptions: { allowUnmatchedView: true },\n          displaySets: [\n            {\n              id: 'srDisplaySetId',\n            },\n          ],\n        },\n      ],\n    },\n  ],\n};\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: srProtocol.id,\n      protocol: srProtocol,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\nexport { srProtocol };\n","import OHIF from '@ohif/core';\nimport { annotation } from '@cornerstonejs/tools';\nconst { log } = OHIF;\n\nfunction getFilteredCornerstoneToolState(\n  measurementData,\n  additionalFindingTypes\n) {\n  const filteredToolState = {};\n\n  function addToFilteredToolState(annotation, toolType) {\n    if (!annotation.metadata?.referencedImageId) {\n      log.warn(\n        `[DICOMSR] No referencedImageId found for ${toolType} ${annotation.id}`\n      );\n      return;\n    }\n\n    const imageId = annotation.metadata.referencedImageId;\n\n    if (!filteredToolState[imageId]) {\n      filteredToolState[imageId] = {};\n    }\n\n    const imageIdSpecificToolState = filteredToolState[imageId];\n\n    if (!imageIdSpecificToolState[toolType]) {\n      imageIdSpecificToolState[toolType] = {\n        data: [],\n      };\n    }\n\n    const measurementDataI = measurementData.find(\n      md => md.uid === annotation.annotationUID\n    );\n    const toolData = imageIdSpecificToolState[toolType].data;\n\n    let { finding } = measurementDataI;\n    const findingSites = [];\n\n    // NOTE -> We use the CORNERSTONEJS coding schemeDesignator which we have\n    // defined in the @cornerstonejs/adapters\n    if (measurementDataI.label) {\n      if (additionalFindingTypes.includes(toolType)) {\n        finding = {\n          CodeValue: 'CORNERSTONEFREETEXT',\n          CodingSchemeDesignator: 'CORNERSTONEJS',\n          CodeMeaning: measurementDataI.label,\n        };\n      } else {\n        findingSites.push({\n          CodeValue: 'CORNERSTONEFREETEXT',\n          CodingSchemeDesignator: 'CORNERSTONEJS',\n          CodeMeaning: measurementDataI.label,\n        });\n      }\n    }\n\n    if (measurementDataI.findingSites) {\n      findingSites.push(...measurementDataI.findingSites);\n    }\n\n    const measurement = Object.assign({}, annotation, {\n      finding,\n      findingSites,\n    });\n\n    toolData.push(measurement);\n  }\n\n  const uidFilter = measurementData.map(md => md.uid);\n  const uids = uidFilter.slice();\n\n  const annotationManager = annotation.state.getAnnotationManager();\n  const framesOfReference = annotationManager.getFramesOfReference();\n\n  for (let i = 0; i < framesOfReference.length; i++) {\n    const frameOfReference = framesOfReference[i];\n\n    const frameOfReferenceAnnotations = annotationManager.getAnnotations(\n      frameOfReference\n    );\n\n    const toolTypes = Object.keys(frameOfReferenceAnnotations);\n\n    for (let j = 0; j < toolTypes.length; j++) {\n      const toolType = toolTypes[j];\n\n      const annotations = frameOfReferenceAnnotations[toolType];\n\n      if (annotations) {\n        for (let k = 0; k < annotations.length; k++) {\n          const annotation = annotations[k];\n          const uidIndex = uids.findIndex(\n            uid => uid === annotation.annotationUID\n          );\n\n          if (uidIndex !== -1) {\n            addToFilteredToolState(annotation, toolType);\n            uids.splice(uidIndex, 1);\n\n            if (!uids.length) {\n              return filteredToolState;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return filteredToolState;\n}\n\nexport default getFilteredCornerstoneToolState;\n","import { metaData, utilities } from '@cornerstonejs/core';\n\nimport OHIF, { DicomMetadataStore } from '@ohif/core';\nimport dcmjs from 'dcmjs';\nimport { adaptersSR } from '@cornerstonejs/adapters';\n\nimport getFilteredCornerstoneToolState from './utils/getFilteredCornerstoneToolState';\n\nconst { MeasurementReport } = adaptersSR.Cornerstone3D;\nconst { log } = OHIF;\n\n/**\n *\n * @param measurementData An array of measurements from the measurements service\n * that you wish to serialize.\n * @param additionalFindingTypes toolTypes that should be stored with labels as Findings\n * @param options Naturalized DICOM JSON headers to merge into the displaySet.\n *\n */\nconst _generateReport = (\n  measurementData,\n  additionalFindingTypes,\n  options = {}\n) => {\n  const filteredToolState = getFilteredCornerstoneToolState(\n    measurementData,\n    additionalFindingTypes\n  );\n\n  const report = MeasurementReport.generateReport(\n    filteredToolState,\n    metaData,\n    utilities.worldToImageCoords,\n    options\n  );\n\n  const { dataset } = report;\n\n  // Set the default character set as UTF-8\n  // https://dicom.innolitics.com/ciods/nm-image/sop-common/00080005\n  if (typeof dataset.SpecificCharacterSet === 'undefined') {\n    dataset.SpecificCharacterSet = 'ISO_IR 192';\n  }\n  return dataset;\n};\n\nconst commandsModule = ({}) => {\n  const actions = {\n    /**\n     *\n     * @param measurementData An array of measurements from the measurements service\n     * @param additionalFindingTypes toolTypes that should be stored with labels as Findings\n     * @param options Naturalized DICOM JSON headers to merge into the displaySet.\n     * as opposed to Finding Sites.\n     * that you wish to serialize.\n     */\n    downloadReport: ({\n      measurementData,\n      additionalFindingTypes,\n      options = {},\n    }) => {\n      const srDataset = actions.generateReport(\n        measurementData,\n        additionalFindingTypes,\n        options\n      );\n      const reportBlob = dcmjs.data.datasetToBlob(srDataset);\n\n      //Create a URL for the binary.\n      var objectUrl = URL.createObjectURL(reportBlob);\n      window.location.assign(objectUrl);\n    },\n\n    /**\n     *\n     * @param measurementData An array of measurements from the measurements service\n     * that you wish to serialize.\n     * @param dataSource The dataSource that you wish to use to persist the data.\n     * @param additionalFindingTypes toolTypes that should be stored with labels as Findings\n     * @param options Naturalized DICOM JSON headers to merge into the displaySet.\n     * @return The naturalized report\n     */\n    storeMeasurements: async ({\n      measurementData,\n      dataSource,\n      additionalFindingTypes,\n      options = {},\n    }) => {\n      // Use the @cornerstonejs adapter for converting to/from DICOM\n      // But it is good enough for now whilst we only have cornerstone as a datasource.\n      log.info('[DICOMSR] storeMeasurements');\n\n      if (!dataSource || !dataSource.store || !dataSource.store.dicom) {\n        log.error(\n          '[DICOMSR] datasource has no dataSource.store.dicom endpoint!'\n        );\n        return Promise.reject({});\n      }\n\n      try {\n        const naturalizedReport = _generateReport(\n          measurementData,\n          additionalFindingTypes,\n          options\n        );\n\n        const { StudyInstanceUID, ContentSequence } = naturalizedReport;\n        // The content sequence has 5 or more elements, of which\n        // the `[4]` element contains the annotation data, so this is\n        // checking that there is some annotation data present.\n        if (!ContentSequence?.[4].ContentSequence?.length) {\n          console.log(\n            'naturalizedReport missing imaging content',\n            naturalizedReport\n          );\n          throw new Error('Invalid report, no content');\n        }\n\n        await dataSource.store.dicom(naturalizedReport);\n\n        if (StudyInstanceUID) {\n          dataSource.deleteStudyMetadataPromise(StudyInstanceUID);\n        }\n\n        // The \"Mode\" route listens for DicomMetadataStore changes\n        // When a new instance is added, it listens and\n        // automatically calls makeDisplaySets\n        DicomMetadataStore.addInstances([naturalizedReport], true);\n\n        return naturalizedReport;\n      } catch (error) {\n        console.warn(error);\n        log.error(\n          `[DICOMSR] Error while saving the measurements: ${error.message}`\n        );\n        throw new Error(\n          error.message || 'Error while saving the measurements.'\n        );\n      }\n    },\n  };\n\n  const definitions = {\n    downloadReport: {\n      commandFn: actions.downloadReport,\n      storeContexts: [],\n      options: {},\n    },\n    storeMeasurements: {\n      commandFn: actions.storeMeasurements,\n      storeContexts: [],\n      options: {},\n    },\n  };\n\n  return {\n    actions,\n    definitions,\n    defaultContext: 'CORNERSTONE_STRUCTURED_REPORT',\n  };\n};\n\nexport default commandsModule;\n","import { addTool } from '@cornerstonejs/tools';\n\nexport default function addToolInstance(\n  name: string,\n  toolClass,\n  configuration?\n): void {\n  class InstanceClass extends toolClass {\n    static toolName = name;\n  }\n  addTool(InstanceClass);\n}\n","import { DisplaySetService, classes } from '@ohif/core';\n\nconst ImageSet = classes.ImageSet;\n\nconst findInstance = (measurement, displaySetService: DisplaySetService) => {\n  const { displaySetInstanceUID, ReferencedSOPInstanceUID: sopUid } =\n    measurement;\n  const referencedDisplaySet = displaySetService.getDisplaySetByUID(\n    displaySetInstanceUID\n  );\n  if (!referencedDisplaySet.images) return;\n  return referencedDisplaySet.images.find(it => it.SOPInstanceUID === sopUid);\n};\n\n/** Finds references to display sets inside the measurements\n * contained within the provided display set.\n * @return an array of instances referenced.\n */\nconst findReferencedInstances = (\n  displaySetService: DisplaySetService,\n  displaySet\n) => {\n  const instances = [];\n  const instanceById = {};\n  for (const measurement of displaySet.measurements) {\n    const { imageId } = measurement;\n    if (!imageId) continue;\n    if (instanceById[imageId]) continue;\n\n    const instance = findInstance(measurement, displaySetService);\n    if (!instance) {\n      console.log('Measurement', measurement, 'had no instances found');\n      continue;\n    }\n\n    instanceById[imageId] = instance;\n    instances.push(instance);\n  }\n  return instances;\n};\n\n/**\n * Creates a new display set containing a single image instance for each\n * referenced image.\n *\n * @param displaySetService\n * @param displaySet - containing measurements referencing images.\n * @returns A new (registered/active) display set containing the referenced images\n */\nconst createReferencedImageDisplaySet = (displaySetService, displaySet) => {\n  const instances = findReferencedInstances(displaySetService, displaySet);\n  // This will be a  member function of the created image set\n  const updateInstances = function() {\n    this.images.splice(\n      0,\n      this.images.length,\n      ...findReferencedInstances(displaySetService, displaySet)\n    );\n    this.numImageFrames = this.images.length;\n  };\n\n  const imageSet = new ImageSet(instances);\n  const instance = instances[0];\n  imageSet.setAttributes({\n    displaySetInstanceUID: imageSet.uid, // create a local alias for the imageSet UID\n    SeriesDate: instance.SeriesDate,\n    SeriesTime: instance.SeriesTime,\n    SeriesInstanceUID: imageSet.uid,\n    StudyInstanceUID: instance.StudyInstanceUID,\n    SeriesNumber: instance.SeriesNumber || 0,\n    SOPClassUID: instance.SOPClassUID,\n    SeriesDescription: `${displaySet.SeriesDescription} KO ${displaySet.instance.SeriesNumber}`,\n    Modality: 'KO',\n    isMultiFrame: false,\n    numImageFrames: instances.length,\n    SOPClassHandlerId: `@ohif/extension-default.sopClassHandlerModule.stack`,\n    isReconstructable: false,\n    // This object is made of multiple instances from other series\n    isCompositeStack: true,\n    madeInClient: true,\n    excludeFromThumbnailBrowser: true,\n    updateInstances,\n  });\n\n  displaySetService.addDisplaySets(imageSet);\n\n  return imageSet;\n};\n\nexport default createReferencedImageDisplaySet;\n","import React from 'react';\nimport getSopClassHandlerModule from './getSopClassHandlerModule';\nimport getHangingProtocolModule, {\n  srProtocol,\n} from './getHangingProtocolModule';\nimport onModeEnter from './onModeEnter';\nimport getCommandsModule from './commandsModule';\nimport preRegistration from './init';\nimport { id } from './id.js';\nimport toolNames from './tools/toolNames';\nimport hydrateStructuredReport from './utils/hydrateStructuredReport';\nimport createReferencedImageDisplaySet from './utils/createReferencedImageDisplaySet';\n\nconst Component = React.lazy(() => {\n  return import(\n    /* webpackPrefetch: true */ './viewports/OHIFCornerstoneSRViewport'\n  );\n});\n\nconst OHIFCornerstoneSRViewport = props => {\n  return (\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <Component {...props} />\n    </React.Suspense>\n  );\n};\n\n/**\n *\n */\nconst dicomSRExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n  onModeEnter,\n\n  preRegistration,\n\n  /**\n   *\n   *\n   * @param {object} [configuration={}]\n   * @param {object|array} [configuration.csToolsConfig] - Passed directly to `initCornerstoneTools`\n   */\n  getViewportModule({ servicesManager, extensionManager }) {\n    const ExtendedOHIFCornerstoneSRViewport = props => {\n      return (\n        <OHIFCornerstoneSRViewport\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n          {...props}\n        />\n      );\n    };\n\n    return [{ name: 'dicom-sr', component: ExtendedOHIFCornerstoneSRViewport }];\n  },\n  getCommandsModule,\n  getSopClassHandlerModule,\n  // Include dynmically computed values such as toolNames not known till instantiation\n  getUtilityModule({ servicesManager }) {\n    return [\n      {\n        name: 'tools',\n        exports: {\n          toolNames,\n        },\n      },\n    ];\n  },\n};\n\nexport default dicomSRExtension;\n\n// Put static exports here so they can be type checked\nexport { hydrateStructuredReport, createReferencedImageDisplaySet, srProtocol };\n","import { SOPClassHandlerId } from './id';\n\nexport default function onModeEnter({ servicesManager }) {\n  const { displaySetService } = servicesManager.services;\n  const displaySetCache = displaySetService.getDisplaySetCache();\n\n  const srDisplaySets = [...displaySetCache.values()].filter(\n    ds => ds.SOPClassHandlerId === SOPClassHandlerId\n  );\n\n  srDisplaySets.forEach(ds => {\n    // New mode route, allow SRs to be hydrated again\n    ds.isHydrated = false;\n  });\n}\n","import {\n  addTool,\n  AngleTool,\n  annotation,\n  ArrowAnnotateTool,\n  BidirectionalTool,\n  CobbAngleTool,\n  EllipticalROITool,\n  CircleROITool,\n  LengthTool,\n  PlanarFreehandROITool,\n} from '@cornerstonejs/tools';\nimport DICOMSRDisplayTool from './tools/DICOMSRDisplayTool';\nimport addToolInstance from './utils/addToolInstance';\nimport { Types } from '@ohif/core';\nimport toolNames from './tools/toolNames';\n\n/**\n * @param {object} configuration\n */\nexport default function init({\n  configuration = {},\n}: Types.Extensions.ExtensionParams): void {\n  addTool(DICOMSRDisplayTool);\n  addToolInstance(toolNames.SRLength, LengthTool, {});\n  addToolInstance(toolNames.SRBidirectional, BidirectionalTool);\n  addToolInstance(toolNames.SREllipticalROI, EllipticalROITool);\n  addToolInstance(toolNames.SRCircleROI, CircleROITool);\n  addToolInstance(toolNames.SRArrowAnnotate, ArrowAnnotateTool);\n  addToolInstance(toolNames.SRAngle, AngleTool);\n  // TODO - fix the SR display of Cobb Angle, as it joins the two lines\n  addToolInstance(toolNames.SRCobbAngle, CobbAngleTool);\n  // TODO - fix the rehydration of Freehand, as it throws an exception\n  // on a missing polyline. The fix is probably in CS3D\n  addToolInstance(toolNames.SRPlanarFreehandROI, PlanarFreehandROITool);\n\n  // Modify annotation tools to use dashed lines on SR\n  const dashedLine = {\n    lineDash: '4,4',\n  };\n  annotation.config.style.setToolGroupToolStyles('SRToolGroup', {\n    SRLength: dashedLine,\n    SRBidirectional: dashedLine,\n    SREllipticalROI: dashedLine,\n    SRCircleROI: dashedLine,\n    SRArrowAnnotate: dashedLine,\n    SRCobbAngle: dashedLine,\n    SRAngle: dashedLine,\n    SRPlanarFreehandROI: dashedLine,\n    global: {},\n  });\n}\n"],"names":["root","factory","exports","module","require","define","amd","globalThis","__WEBPACK_EXTERNAL_MODULE__762__","__WEBPACK_EXTERNAL_MODULE__845__","__WEBPACK_EXTERNAL_MODULE__867__","__WEBPACK_EXTERNAL_MODULE__464__","__WEBPACK_EXTERNAL_MODULE__32__","__WEBPACK_EXTERNAL_MODULE__836__","__WEBPACK_EXTERNAL_MODULE__369__","deferred","installedChunks","state","TrackingUniqueIdentifier","trackingIdentifiersByViewportId","setTrackingUniqueIdentifiersForElement","element","trackingUniqueIdentifiers","activeIndex","arguments","length","undefined","enabledElement","getEnabledElement","viewport","id","getTrackingUniqueIdentifiersForElement","guid","OHIF","MeasurementReport","CORNERSTONE_3D_TAG","adaptersSR","Cornerstone3D","CORNERSTONE_3D_TOOLS_SOURCE_NAME","CORNERSTONE_3D_TOOLS_SOURCE_VERSION","supportedLegacyCornerstoneTags","convertCode","codingValues","code","CodingSchemeDesignator","ref","CodeValue","text","CodeMeaning","convertSites","sites","ret","i","site","push","hydrateStructuredReport","_ref","displaySetInstanceUID","servicesManager","extensionManager","dataSource","getActiveDataSource","measurementService","displaySetService","customizationService","services","getCustomization","displaySet","getDisplaySetByUID","mappings","getSourceMappings","Error","instance","DicomMetadataStore","getInstance","StudyInstanceUID","SeriesInstanceUID","SOPInstanceUID","sopInstanceUIDToImageId","imageIdsForToolState","measurements","forEach","measurement","ReferencedSOPInstanceUID","imageId","frameNumber","datasetToUse","dataset","REPORT","GROUP","TRACKING_IDENTIFIER","imagingMeasurementContent","toArray","ContentSequence","find","codeMeaningEquals","measurementGroups","filter","measurementData","cornerstoneToolClasses","CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE","registeredToolClasses","Object","keys","key","measurementGroup","index","TrackingIdentifierGroup","contentItem","ConceptNameCodeSequence","TrackingIdentifier","TextValue","cornerstoneTag","toolName","split","includes","mappedTrackingIdentifier","_mapLegacyDataSet","storedMeasurementByAnnotationType","generateToolState","utilities","imageToWorldCoords","metaData","mappingDefinitions","map","m","annotationType","hydratableMeasurementsInSR","imageIds","targetStudyInstanceUID","toolData","annotation","data","sopInstanceUid","SeriesInstanceUIDs","get","console","warn","uid","FrameOfReferenceUID","annotationUID","metadata","referencedImageId","source","getSource","label","findingSites","finding","freeTextLabel","fs","getLabelFromDCMJSImportedToolData","matchingMapping","addRawMeasurement","toMeasurementSchema","isHydrated","x","Array","isArray","codeMeaningName","create","_console","_len","args","_key","concat","apply","alreadyWarned","_len2","_key2","Date","loadedClb","i18n","cb","isInitialized","on","initialized","setTimeout","off","loadNamespaces","ns","loadLanguages","lng","n","options","indexOf","obj","Symbol","iterator","constructor","prototype","_toPropertyKey","arg","input","hint","prim","toPrimitive","res","call","TypeError","String","Number","value","defineProperty","enumerable","configurable","writable","matchHtmlEntity","htmlEntities","unescapeHtmlEntity","defaultOptions","bindI18n","bindI18nStore","transEmptyNodeValue","transSupportBasicHtmlNodes","transWrapTextNodes","transKeepBasicHtmlNodesFor","useSuspense","unescape","replace","i18nInstance","_defineProperties","target","props","descriptor","createContext","ReportNamespaces","Constructor","_classCallCheck","this","usedNamespaces","protoProps","staticProps","namespaces","_this","_arrayLikeToArray","arr","len","arr2","_i","_s","_e","_x","_r","_arr","_n","_d","next","done","err","o","minLen","toString","slice","name","from","test","object","enumerableOnly","getOwnPropertySymbols","symbols","sym","getOwnPropertyDescriptor","getOwnPropertyDescriptors","defineProperties","usePrevious","ignore","useRef","useEffect","current","i18nFromProps","useContext","i18nFromContext","defaultNSFromContext","defaultNS","reportNamespaces","notReadyT","k","optsOrDefaultValue","defaultValue","retNotReady","t","ready","react","wait","i18nOptions","keyPrefix","addUsedNamespaces","initializedStoreOnce","every","languages","ignoreJSONStructure","hasLoadedNamespace","precheck","loadNotPending","backendConnector","backend","isLanguageChangingTo","fallbackLng","lastLng","toLowerCase","l","loadState","hasResourceBundle","resources","partialBundledLanguages","oldI18nextHasLoadedNamespace","getT","getFixedT","nsMode","_useState2","useState","setT","joinedNS","join","previousJoinedNS","isMounted","boundReset","store","e","isInitial","Promise","resolve","formatDate","utils","OHIFCornerstoneSRViewport","children","displaySets","viewportIndex","viewportLabel","viewportOptions","cornerstoneViewportService","srDisplaySet","viewportGrid","viewportGridService","useViewportGrid","measurementSelected","setMeasurementSelected","measurementCount","setMeasurementCount","activeImageDisplaySetData","setActiveImageDisplaySetData","referencedDisplaySetMetadata","setReferencedDisplaySetMetadata","setElement","viewports","activeViewportIndex","trackedMeasurements","sendTrackedMeasurementsEvent","registeredExtensionIds","contextModule","getModuleEntry","tracked","context","eventName","clearMeasurements","getDisplaySetsForSeries","setDisplaySetsForViewports","displaySetInstanceUIDs","setTrackingIdentifiers","useCallback","onElementEnabled","evt","detail","updateViewport","newMeasurementSelected","sopClassUids","async","referencedDisplaySet","image0","images","PatientID","PatientName","PatientSex","PatientAge","SliceThickness","StudyDate","SeriesDescription","SeriesNumber","ManufacturerModelName","SpacingBetweenSlices","_getViewportReferencedDisplaySetData","then","_ref2","viewportInfo","getViewportInfoByIndex","csViewport","getCornerstoneViewport","getViewportId","imageIdIndex","getImageIds","setImageIdIndex","component","Component","initialImageIndex","findIndex","image","React","_extends","toolGroupId","viewportType","positionIds","onMeasurementChange","direction","onDisplaySetsRemovedSubscription","subscribe","EVENTS","DISPLAY_SETS_REMOVED","_ref3","activeViewport","setDisplaySetsForViewport","unsubscribe","isLoaded","load","numMeasurements","isLocked","trackedSeries","childrenWithProps","child","ViewportActionBar","onDoubleClick","stopPropagation","preventDefault","onArrowsClick","getStatusComponent","_ref4","isRehydratable","handleMouseUp","useTranslation","loadStr","ToolTipMessage","StatusIcon","Icon","StatusArea","className","onMouseUp","Tooltip","content","position","_getStatusComponent","isTracked","studyData","useAltStyling","studyDate","currentSeries","seriesDescription","patientInformation","patientName","formatPN","Alphabetic","patientSex","patientAge","MRN","thickness","toFixed","spacing","scanner","propTypes","PropTypes","isRequired","customProps","ServicesManager","ExtensionManager","defaultProps","hasOwnProperty","propIsEnumerable","propertyIsEnumerable","assign","test1","getOwnPropertyNames","test2","fromCharCode","test3","letter","shouldUseNative","to","val","toObject","s","ReactPropTypesSecret","emptyFunction","emptyFunctionWithReset","resetWarningCache","shim","propName","componentName","location","propFullName","secret","getShim","ReactPropTypes","array","bigint","bool","func","number","string","symbol","any","arrayOf","elementType","instanceOf","node","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","p","Fragment","StrictMode","Profiler","q","r","Suspense","u","v","for","w","z","a","b","c","encodeURIComponent","A","enqueueForceUpdate","enqueueReplaceState","enqueueSetState","B","C","refs","updater","D","E","isReactComponent","setState","forceUpdate","F","isPureReactComponent","G","H","I","__self","__source","J","d","h","g","f","$$typeof","type","_owner","L","M","N","escape","O","K","y","P","Q","_status","_result","default","R","S","T","ReactCurrentDispatcher","ReactCurrentBatchConfig","transition","ReactCurrentOwner","IsSomeRendererActing","Children","count","only","PureComponent","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","cloneElement","_calculateChangedBits","_currentValue","_currentValue2","_threadCount","Provider","Consumer","_context","createElement","createFactory","bind","createRef","forwardRef","render","isValidElement","lazy","_payload","_init","memo","compare","useDebugValue","useImperativeHandle","useLayoutEffect","useMemo","useReducer","version","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","result","chunkIds","fn","priority","notFulfilled","Infinity","fulfilled","j","splice","chunkId","getter","__esModule","definition","prop","toStringTag","link","document","nc","setAttribute","rel","as","href","head","appendChild","packageJson","SOPClassHandlerName","SOPClassHandlerId","POINT","MULTIPOINT","POLYLINE","CIRCLE","ELLIPSE","DICOMSRDisplayTool","AnnotationTool","super","configuration","isPointNearTool","getHandleNearImagePoint","renderAnnotation","svgDrawingHelper","annotations","getAnnotations","getToolName","filterInteractableAnnotationsForElement","trackingUniqueIdentifiersForElement","activeTrackingUniqueIdentifier","filteredAnnotations","cachedStats","_actors","size","styleSpecifier","viewportId","renderableData","lineWidth","getStyle","lineDash","color","GraphicType","renderableDataForGraphicType","renderMethod","canvasCoordinatesAdapter","SCOORD_TYPES","renderPoint","renderMultipoint","renderPolyLine","renderEllipse","math","ellipse","getCanvasEllipseCorners","canvasCoordinates","renderTextBox","_getTextBoxLinesFromLabels","labels","labelLength","Math","min","lines","labelEntry","_labelToShorthand","drawingOptions","width","allCanvasCoordinates","worldToCanvas","lineUID","drawing","drawLine","drawPolyline","drawHandles","point","imagePixelModule","xOffset","yOffset","columns","rows","imagePoint","csUtils","worldToImageCoords","arrowEnd","arrowUID","drawArrow","ellipsePointsWorld","rotation","getRotation","canvasCorners","drawEllipse","adaptedCanvasCoordinates","textLines","canvasTextBoxCoords","getTextBoxCoordsCanvas","handles","textBox","worldPosition","canvasToWorld","textBoxPosition","textBoxOptions","getLinkedTextBoxStyle","boundingBox","drawLinkedTextBox","left","top","height","worldBoundingBox","topLeft","topRight","bottomLeft","bottomRight","SHORT_HAND_MAP","AREA","Length","CORNERSTONEFREETEXT","shortHand","DICOMSRDisplay","SRLength","SRBidirectional","SREllipticalROI","SRCircleROI","SRArrowAnnotate","SRAngle","SRCobbAngle","SRRectangleROI","SRPlanarFreehandROI","EPSILON","addMeasurement","toolNames","coords","coord","GraphicData","worldPos","pointsWorld","center","onPerimeter","radius","vec3","distance","imagePlaneModule","columnCosines","rowCosines","firstAxisStart","scaleAndAdd","firstAxisEnd","secondAxisStart","secondAxisEnd","majorAxisStart","fromValues","majorAxisEnd","minorAxisStart","minorAxisEnd","majorAxisVec","sub","normalize","minorAxisVec","columnCosinesVec","projectedMajorAxisOnColVec","abs","dot","projectedMinorAxisOnColVec","absoluteOfMajorDotProduct","absoluteOfMinorDotProduct","_getRenderableData","annotationManager","getAnnotationManager","ReferencedSOPSequence","ReferencedFrameNumber","SRAnnotation","frameOfReferenceUID","addAnnotation","loaded","cornerstoneAdapters","CodeScheme","Cornerstone3DCodeScheme","ImageSet","MetadataProvider","metadataProvider","classes","validateSameStudyUID","instances","it","CodeNameCodeSequenceValues","ImagingMeasurementReport","ImageLibrary","ImagingMeasurements","MeasurementGroup","ImageLibraryGroup","Finding","FindingSite","CornerstoneFreeText","codeValues","CodingSchemeDesignators","SRT","CornerstoneCodeSchemes","RELATIONSHIP_TYPE","INFERRED_FROM","CONTAINS","CORNERSTONE_FREETEXT_CODE_VALUE","addInstances","sortStudyInstances","_getDisplaySetsFromSeries","SeriesDate","SOPClassUID","uiNotificationService","show","title","message","duration","Modality","referencedImages","isDerivedDisplaySet","dataSources","getDataSources","ImagingMeasurementReportContentSequence","_getSequenceAsArray","item","ReferencedSOPClassUID","_getReferencedImagesList","mergedContentSequencesByTrackingUniqueIdentifiers","MeasurementGroups","TrackingUniqueIdentifierItem","trackingUniqueIdentifier","UID","_getMergedContentSequencesByTrackingUniqueIdentifiers","mergedContentSequence","some","group","ValueType","graphicItem","UIDREFContentItem","TrackingIdentifierContentItem","NUMContentItems","_getCoordsFromSCOORDOrSCOORD3D","MeasuredValueSequence","_getLabelFromMeasuredValueSequence","_processTID1410Measurement","ConceptCodeSequence","cornerstoneFreeTextFindingSite","_processNonGeometricallyDefinedMeasurement","_processMeasurement","_getMeasurements","adapterKeys","adapterKey","isValidCornerstoneTrackingIdentifier","adapters","adapter","log","activeDisplaySets","activeDisplaySet","_checkIfCanAddMeasurementsToDisplaySet","DISPLAY_SETS_ADDED","displaySetsAdded","newDisplaySet","_load","unloadedMeasurements","SOPInstanceUIDs","imageIdsForDisplaySet","getImageIdsForDisplaySet","getUIDsFromImageID","_measurementReferencesSOPInstanceUID","RelationshipType","ReferencedFrameOfReferenceSequence","NumericValue","MeasurementUnitsCodeSequence","sequence","getDisplaySetsFromSeries","srProtocol","hasUpdatedPriorsInformation","protocolMatchingRules","toolGroupIds","numberOfPriorsReferenced","defaultViewport","allowUnmatchedView","matchedDisplaySetsIndex","displaySetSelectors","srDisplaySetId","seriesMatchingRules","attribute","constraint","equals","stages","viewportStructure","layoutType","properties","additionalFindingTypes","filteredToolState","addToFilteredToolState","toolType","imageIdSpecificToolState","measurementDataI","md","uids","framesOfReference","getFramesOfReference","frameOfReference","frameOfReferenceAnnotations","toolTypes","uidIndex","actions","downloadReport","srDataset","generateReport","reportBlob","dcmjs","datasetToBlob","objectUrl","URL","createObjectURL","window","storeMeasurements","info","dicom","error","reject","naturalizedReport","getFilteredCornerstoneToolState","report","SpecificCharacterSet","_generateReport","deleteStudyMetadataPromise","definitions","commandFn","storeContexts","defaultContext","addToolInstance","toolClass","InstanceClass","addTool","findInstance","sopUid","findReferencedInstances","instanceById","createReferencedImageDisplaySet","imageSet","setAttributes","SeriesTime","isMultiFrame","numImageFrames","isReconstructable","isCompositeStack","madeInClient","excludeFromThumbnailBrowser","updateInstances","addDisplaySets","fallback","onModeEnter","getDisplaySetCache","values","ds","preRegistration","LengthTool","BidirectionalTool","EllipticalROITool","CircleROITool","ArrowAnnotateTool","AngleTool","CobbAngleTool","PlanarFreehandROITool","dashedLine","config","style","setToolGroupToolStyles","global","getViewportModule","getCommandsModule","getSopClassHandlerModule","getUtilityModule"],"sourceRoot":""}